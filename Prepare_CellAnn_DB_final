####
#### this is the final script to prepare the raw data sets in the database ####
####

####
####
####

#### First we write a function ####
#### input is a folder ############
#### search the seurat file in that folder ######
####
#### this is on the new server: ###
####

ssh plyu3@omb2.onc.jhmi.edu
U[9C20&&

conda activate seurat4

#### I want to copy the folder to my own folder !!!! #####

cp -r "/zp1/data/yzhai11/UCSC/" "/zp1/data/plyu3/UCSC/"

####
input_folder_example = "/zp1/data/plyu3/UCSC/pmid27667365_Human pancreas"
input_folder = input_folder_example

####
####

R

Read_Seurat_file_in_the_folder_UCSC <- function(input_folder){
	##### first we init a table ######
	checked_items = c('Seurat_files_exists:','Seurat_file_celltypes:','Seurat_file_dims:','Seurat_file_matrix_equal:','Seurat_file_matrix_max:','Seurat_file_matrix_log:','Seurat_file_matrix_log2:','Seurat_file_matrix_counts:','Seurat_file_Genes:','Seurat_file_matrix_counts_sum:')
	##### 
	checked_table = data.frame(checked_items=checked_items,results="Need to check!")
	##### loading library !!! #####
	library(Seurat)
	##### we first go into the folder ######
	setwd(input_folder)
	##### 'Seurat_files_exists:' #####
	files = list.files()
	#####
	##### searching seurat files ########
	##### 
	k = grep("_seurat_obj$",files)
	#####
	if(length(k) != 1){
		checked_table$results[1] = 'No file!'
		write.table(checked_items,file='checked_items.txt',sep="\t",quote=F,row.names=F)
		return(checked_items)
	}
	if(length(k) == 1){
		checked_table$results[1] = 'OK!'
		###### Next we will load the seurat objects !!!! ##########
		seurat_file = files[k]
		seurat_obj <- readRDS(seurat_file)
		###### Next we will check whether celltype exists: ########
		k1 = which(colnames(seurat_obj@meta.data) == "celltype")
		if(length(k1) != 1){
			checked_items$results[2] = 'No celltype!'
			write.table(checked_table,file='checked_items.txt',sep="\t",quote=F,row.names=F)
			return(checked_items)
		}
		if(length(k) == 1){
			checked_table$results[2] = 'OK!'
			###### Next we will check the dims !!!! ##############
			k2 = which(colnames(seurat_obj@meta.data) %in% c("dim1","dim2","dim3") == T)
			if(length(k2) < 2){
				checked_table$results[3] = 'No dims!'
				write.table(checked_table,file='checked_items.txt',sep="\t",quote=F,row.names=F)
				return(checked_items)
			}
			if(length(k2) > 1){
				checked_table$results[3] = 'OK!'
				##### Next check whether matrix is equal!!! #######
				##### RNA@data matrix and RNA@counts matrix #######
				data_mat = seurat_obj[['RNA']]@data[1:100,1:100]
				count_mat = seurat_obj[['RNA']]@counts[1:100,1:100]
				#####
				res = all.equal(data_mat,count_mat)
				#####
				checked_table$results[4] = res
				#####
				count_mat = seurat_obj[['RNA']]@counts[,1:100]
				max = max(as.vector(count_mat))
				#####
				if(max < 20){
					checked_table$results[5] = max
				}
				if(max > 50){
					checked_table$results[5] = max
				}
				####### top5 sums #####
				####
				sums = as.character(round(Matrix::colSums(exp(count_mat))[1:5],2))
				####
				sums_res = paste(sums,collapse='::')
				####
				checked_table$results[6] = sums_res
				####
				sums = as.character(round(Matrix::colSums(2^(count_mat))[1:5],2))
				sums_res = paste(sums,collapse='::')
				checked_table$results[7] = sums_res
				####
				sums = as.character(round(Matrix::colSums(count_mat)[1:5],2))
				sums_res = paste(sums,collapse='::')
				checked_table$results[10] = sums_res
				#### print the non-Zero number in the matrix #######
				####
				count_mat_v <- as.vector(count_mat)
				count_mat_v = count_mat_v[which(count_mat_v > 0)]
				count_mat_v = round(count_mat_v,3)
				sums_res = paste(count_mat_v[1:5],collapse='::')
				checked_table$results[8] = sums_res
				#### 
				######## Next we will check the genes !!! ##########
				####
				#### plot the first rownames of the seurat objects !!! #####
				####
				Genes = rownames(seurat_obj)[1:5]
				####
				sums_res = paste(Genes[1:5],collapse='::')
				checked_table$results[9] = sums_res
				####
				write.table(checked_table,file='checked_items.txt',sep="\t",quote=F,row.names=F)
				return(checked_table)
			}
		}
	}
	#####
	#####
}

######
######
###### add dims from seurat objects metadata to seurat inside #######
######
######
######
###### ###### ######

Prepare_Seurat_file_in_the_folder_UCSC <- function(input_folder,norm="log"){
	#########
	library(Seurat)
	##### we first go into the folder ######
	setwd(input_folder)
	##### 'Seurat_files_exists:' #####
	files = list.files()
	#####
	##### searching seurat files ########
	##### 
	k = grep("_seurat_obj$",files)
	#####
	#########
	seurat_file = files[k]
	seurat_obj <- readRDS(seurat_file)
	print(dim(seurat_obj))
	#########
	if(dim(seurat_obj)[2] > 25000){
		index = sample(1:dim(seurat_obj)[2],25000)
		seurat_obj = seurat_obj[,index]
	}
	##### first we convert matrix to counts ##########
	if(norm == "log"){
		######
		mat = seurat_obj[['RNA']]@counts
		mat_new = exp(mat)-1
		######
	}
	if(norm == "counts"){
		######
		mat = seurat_obj[['RNA']]@counts
		mat_new = mat
		######
	}
	if(norm == "log2"){
		######
		mat = seurat_obj[['RNA']]@counts
		mat_new = 2^(mat)-1
		######
	}
	#####
	seurat_obj_new = CreateSeuratObject(mat_new)
	seurat_obj_new@meta.data = seurat_obj@meta.data
	#####
	##### next we add dims to this seurat_obj #######
	#####
	dims_index = c("dim1","dim2","dim3")
	k = match(dims_index,colnames(seurat_obj_new@meta.data))
	k = k[is.na(k) == F]
	UMAPs_mat = as.matrix(seurat_obj@meta.data[,k])
	UMAPs_mat_new = Norm_UMAPs(UMAPs_mat)
	#####
	#####
	#####
	seurat_obj_new[['dims']] <- CreateDimReducObject(embeddings = UMAPs_mat_new, key = "dims_", assay = 'RNA')
	#####
	#png_file = paste0("dim_check.png")
	#png(png_file,height=5000,width=6000,res=72*12)
	#print(DimPlot(seurat_obj_new, reduction = "dims",group.by=c('celltype'),label = TRUE, label.size = 2.5, repel = TRUE,raster = FALSE))
	#dev.off()
	###### 
	###### Next we will create the files #######
	######
	seurat_file_new = paste(seurat_file,'_new',sep="")
	######
	saveRDS(seurat_obj_new,file=seurat_file_new)
}



#### OK!!! ######
#### then we write small functions ########
####

#### 这个是OK的 ！！！##### 
####
Norm_UMAPs <- function(UMAPs_mat){
	#### each rows and cols norms to the -50 50 dims #######
	####
	UMAPs_mat_new = UMAPs_mat
	####
	for(i in 1:dim(UMAPs_mat)[2]){
		tmp_vector = UMAPs_mat[,i]
		tmp_vector_mean = tmp_vector - mean(tmp_vector)
		tmp_vector_scale = 100 / (max(tmp_vector) - min(tmp_vector))
		tmp_vector_norm = tmp_vector_mean*tmp_vector_scale
		UMAPs_mat_new[,i] = round(tmp_vector_norm,3)
	}
	####
	return(UMAPs_mat_new)
}




#### #####
#### we will need to know the UCSC processing piplines #####
#### #####

####
#### Next we will prepare the Dim files and the markers and the celltype submarkers #############
#### Input is the seurat_obj ####################################################################
#### call sub clusters and call sub markers #######
####
#### this is the runDEGs_Ref ######
####

runDEGs_Ref <- function(Seurat_Obj,method='COSG',idents='celltype',num_of_genes = 100){
	Idents(Seurat_Obj) = idents
	#######
	library(COSG)
	#######
	if(method == 'COSG'){
		marker_cosg <- cosg(
 				Seurat_Obj,
 				groups=c('all'),
 				assay='RNA',
 				slot='data',
 				mu=1,
 				n_genes_user=num_of_genes)
		res = marker_cosg$names
	}
	#######
	#######
	return(res)
}

#####
#####
##### input is the log transformed matrix #######
#####
#####

CellAnn_Avg_Mat <- function(data_mat,data_cluster,log='log',scale_factor=10000){
	######
	tag_cluster = unname(data_cluster)
	tag_cluster_level = levels(as.factor(tag_cluster))
	###### normalized back datasets ######
	if(log == 'log'){
		data_mat_exp = exp(data_mat)
		data_mat_exp = data_mat_exp-1
	}
	if(log == 'log2'){
		data_mat_exp = 2^(data_mat)
		data_mat_exp = data_mat_exp-1
	}
	print(paste('Sums:',head(colSums(data_mat_exp[,c(1:2)]))))
	###### data_mat_exp is 1e5 normalize #######
	merge_mat = c()
	for(i in 1:length(tag_cluster_level)){
		index = which(data_cluster %in% tag_cluster_level[i] == T)
		index_mat = data_mat_exp[,index]
		######
		index_sum = rowSums(index_mat)
		######
		merge_mat = c(merge_mat,index_sum)
	}
	###
	merge_mat = matrix(merge_mat,nrow=dim(data_mat)[1])
	###
	rownames(merge_mat) = rownames(data_mat)
	colnames(merge_mat) = tag_cluster_level
	### colSums(merge_mat)
	scale = colSums(merge_mat)/scale_factor
	merge_mat = sweep(merge_mat,2,scale,FUN='/')
	### default norm ####
	merge_mat = round(log(merge_mat+1),3)
	return(merge_mat)
	### return is a log transformed matrix ####
}

##############
############## this function subset each celltype annotation ######
############## keys = "celltype"
############## 变成 subset seurat ##################################
############## 

subset_each_ct <- function(data,resolution){
	#####
	matrix_list = list()
	##### ct ######
	ct = levels(as.factor(data$celltype))
	#####
	cells_list = list()
	#####
	for(j in 1:length(ct)){
		print(ct[j])
		#######
		k = which(data$celltype == ct[j])
		#######
		if(length(k) > 1){
			print('large')
			#######
			sub_seurat = subset(data,subset = celltype == ct[j])
			#######
			dim_length = dim(sub_seurat@reductions$dims@cell.embeddings)[2]
			#######
			sub_seurat = FindNeighbors(sub_seurat,reduction="dims",dims=c(1:dim_length))
			sub_seurat = FindClusters(sub_seurat,resolution=resolution)
			sub_seurat_mat = sub_seurat[['RNA']]@data
			data_cluster = sub_seurat$seurat_clusters
			data_cluster = paste(ct[j],data_cluster,sep='@sub')
			sub_seurat_avg = CellAnn_Avg_Mat(data_mat=sub_seurat_mat,data_cluster)
			matrix_list = c(matrix_list,list(sub_seurat_avg))
			######
			cells_table = data.frame(cells=colnames(sub_seurat_mat),new_sub_cluster = data_cluster)
			cells_list = c(cells_list,list(cells_table))
		}
	}
	matrix_list = do.call('cbind',matrix_list)
	cells_list = do.call('rbind',cells_list)
	####
	return(list(matrix_list,cells_list))
}


######
######

Prepare_Seurat_file_in_the_folder_UCSC_STEP2 <- function(input_folder){
	#########
	library(Seurat)
	##### we first go into the folder ######
	setwd(input_folder)
	##### 'Seurat_files_exists:' #####
	files = list.files()
	#####
	##### searching seurat files ########
	##### 
	k = grep("_seurat_obj_new$",files)
	#####
	#########
	seurat_file = files[k]
	seurat_obj <- readRDS(seurat_file)
	######### Performing log-normalization ###########
	##### first we convert matrix to counts ##########
	seurat_obj <- NormalizeData(seurat_obj)
	#####
	#####
	subset_matrix_res = subset_each_ct(seurat_obj,resolution=0.5)
	##### OK! what is the next ? #####################
	#####
	subset_matrix = subset_matrix_res[[1]]
	subset_cell = subset_matrix_res[[2]]
	#####
	m = match(colnames(seurat_obj),subset_cell$cells)
	seurat_obj$cell_id = subset_cell$cells[m]
	seurat_obj$celltype_sub = subset_cell$new_sub_cluster[m]
	#####
	##### OK!!! we finished annotation these cells, next to check to see the results: #########
	#####
	png_file = paste0("sub_ct_check.png")
	png(png_file,height=5000,width=26000,res=72*12)
	print(DimPlot(seurat_obj, reduction = "dims",group.by=c('celltype_sub'),label = FALSE,raster = FALSE))
	dev.off()
	###### OK!! Next we will see the results !!! ############
	###### first we generate the avg expression matrix !!! ##
	######
	celltype_avg = CellAnn_Avg_Mat(seurat_obj[['RNA']]@data,seurat_obj$celltype)
	sub_celltype_avg = CellAnn_Avg_Mat(seurat_obj[['RNA']]@data,seurat_obj$celltype_sub)
	###### then we will call markers ########################
	######
	celltype_marker = runDEGs_Ref(seurat_obj,method='COSG',idents='celltype',num_of_genes=100)
	sub_celltype_marker = runDEGs_Ref(seurat_obj,method='COSG',idents='celltype_sub',num_of_genes=100)
	###### then we will save these files ####################
	######
	saveRDS(seurat_obj,file=files[k])
	######
	saveRDS(celltype_avg,file=paste0(files[k],"_avg_mat"))
	saveRDS(sub_celltype_avg,file=paste0(files[k],"_avg_sub_mat"))
	saveRDS(celltype_marker,file=paste0(files[k],"_marker"))
	saveRDS(sub_celltype_marker,file=paste0(files[k],"_sub_marker"))
	######
	###### also need to provide dimplot file !! #######
	###### 
	dim_files = data.frame(seurat_obj@reductions$dims@cell.embeddings)
	dim_files_width = dim(dim_files)[2]
	colnames(dim_files) <- paste0("dim",1:dim_files_width)
	######
	dim_files$cluster = seurat_obj$celltype
	###### re-order dim files #######
	dim_files = dim_files[,c(dim_files_width+1,1:dim_files_width)]
	print(head(dim_files))
	saveRDS(dim_files,file=paste0(files[k],"_Dimplot"))
	######
	print("Finished !!!")
}

########## should convert to “pmid” + PMID number + “_Dimplot” tags ######
##########

Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder <- function(From_folder,To_folder,TAG){
	############# we need to search files in the From_folder ##########
	setwd(From_folder)
	#############
	files = list.files()
	#############
	### first: "_avg_mat" ##
	k1 = grep("_avg_mat$",files)
	k2 = grep("_avg_sub_mat$",files)
	k3 = grep("_Dimplot$",files)
	k4 = grep("new_marker$",files)
	k5 = grep("new_sub_marker$",files)
	#############
	file_avg_mat_target = paste0('pmid',TAG,'_avg_mat')
	file_avg_sub_mat_target = paste0('pmid',TAG,'_avg_sub_mat')
	file_Dimplot_target = paste0('pmid',TAG,'_Dimplot')
	file_marker_target = paste0('pmid',TAG,'_marker')
	file_sub_marker_target = paste0('pmid',TAG,'_sub_marker')
	#############
	file_avg_mat_target2 = paste0(To_folder,file_avg_mat_target)
	file_avg_sub_mat_target2 = paste0(To_folder,file_avg_sub_mat_target)
	file_Dimplot_target2 = paste0(To_folder,file_Dimplot_target)
	file_marker_target2 = paste0(To_folder,file_marker_target)
	file_sub_marker_target2 = paste0(To_folder,file_sub_marker_target)
	############# we use a command to copy these files ####################
	#############
	command1 = paste('cp',files[k1],file_avg_mat_target2)
	command2 = paste('cp',files[k2],file_avg_sub_mat_target2)
	command3 = paste('cp',files[k3],file_Dimplot_target2)
	command4 = paste('cp',files[k4],file_marker_target2)
	command5 = paste('cp',files[k5],file_sub_marker_target2)
	print(command1)
	print(command2)
	print(command3)
	print(command4)
	print(command5)
	#############
	system(command1)
	system(command2)
	system(command3)
	system(command4)
	system(command5)
	##############
	Datasheet_table = data.frame(PMID=TAG,reference_index=paste0('pmid',TAG),reference_avg_mat=file_avg_mat_target,reference_avg_sub_mat=file_avg_sub_mat_target,reference_marker=file_marker_target,reference_sub_marker=file_sub_marker_target)
	##############
	setwd(To_folder)
	files = list.files()
	##############
	k6 = grep("reference_table2_add.txt",files)
	##############
	if(length(k6) == 0){
		##### then we write it as a new table ############
		write.table(Datasheet_table,file="reference_table2_add.txt",sep="\t",row.names=F,quote=F)
	}
	if(length(k6) > 0){
		print("Find!!!")
		##### then we write it as a new table ############
		Datasheet_table_Ori = read.table(files[k6],sep="\t",header=T)
		#####
		Datasheet_table = rbind(Datasheet_table_Ori,Datasheet_table)
		#####
		Datasheet_table = Datasheet_table[!duplicated(Datasheet_table$PMID),]
		#####
		write.table(Datasheet_table,file="reference_table2_add.txt",sep="\t",row.names=F,quote=F)
	}
}


###########
###########
########### OK!!! we need to first provide the additional tables for table2 and total tables ###########
###########
###########

we will create a new folder 

cd /zp1/data/plyu3

mkdir /zp1/data/plyu3/CellAnn_batch1

###########
########### OK!!! let us to start !!!! #######
###########
########### Open the table in the cellAnn db ################
###########
27062923_Human_preimplant_embryos
Single-Cell RNA-Seq Reveals Lineage and X Chromosome Dynamics in Human Preimplantation Embryos

pmid27062923_Human preimplant embryos

Read_Seurat_file_in_the_folder_UCSC("/zp1/data/plyu3/UCSC/pmid27062923_Human preimplant embryos")

########### Not used !!! ########
########### red #################
###########

pmid27667365_Human pancreas

folder = "/zp1/data/plyu3/UCSC/pmid27667365_Human pancreas"
to = "/zp1/data/plyu3/CellAnn_batch1/"
TAG = "27667365_Human_pancreas"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

###########
########### Next another study !!! ######
folder = "/zp1/data/plyu3/UCSC/pmid28279351_H1 human embryonic stem cells"
to = "/zp1/data/plyu3/CellAnn_batch1/"
TAG = "28279351_H1"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

########### Next !!! #############
folder = "/zp1/data/plyu3/UCSC/pmid28846088_Human brain"
TAG = "28846088_Human_brain"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid29091775_Human Glioblastoma"
TAG = "28846088_Human_Glioblastoma"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



###########
########### Next !!!! #############
########### OK!!!! let do it another 5 samples !!!!! #######
###########

folder = "/zp1/data/plyu3/UCSC/pmid29980650_Kidney Inflammatory Response"
TAG = "29980650_Kidney"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


########## 
folder = "/zp1/data/plyu3/UCSC/pmid30726734_Neonatal and Adult Human Testis"
TAG = "30726734_Neonatal_Testis"

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

###########

folder = "/zp1/data/plyu3/UCSC/pmid31097668_Autism patients cortex"
TAG = "31097668_cortex"

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

###########
folder = "/zp1/data/plyu3/UCSC/pmid31348891_Human Colon during Ulcerative Colitis/Epithelium"
TAG = "331348891_Human_Colon_Epithelium"

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



folder = "/zp1/data/plyu3/UCSC/pmid31348891_Human Colon during Ulcerative Colitis/Fibroblasts"
TAG = "331348891_Human_Colon_Fibroblasts"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



folder = "/zp1/data/plyu3/UCSC/pmid31348891_Human Colon during Ulcerative Colitis/Immune"
TAG = "331348891_Human_Colon_Immune"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


####### OK!!! Next paper !!! ######
#######


folder = "/zp1/data/plyu3/UCSC/pmid31511693_Human hPSCs"
TAG = "31511693_Human_hPSCs"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#######
folder = "/zp1/data/plyu3/UCSC/pmid31554641_Proliferating Glioblastoma Cells"
TAG = "31554641_Human_Glioblastoma"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#######
#######
#######



cd /zp1/data/plyu3

mkdir /zp1/data/plyu3/CellAnn_batch2/

to = "/zp1/data/plyu3/CellAnn_batch2/"

#######
#######

folder = "/zp1/data/plyu3/UCSC/pmid31558434_COVID-19 Nasal sample"
TAG = "31558434_COVID-19"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


########

folder = "/zp1/data/plyu3/UCSC/pmid31597962_Human fetal liver haematopoiesis"
TAG = "31597962_Human_fetal_liver"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#########
folder = "/zp1/data/plyu3/UCSC/pmid31892341_ lung spleen esophagus after cold preservation/Lung"
TAG = "31892341_lung"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#########
folder = "/zp1/data/plyu3/UCSC/pmid31892341_ lung spleen esophagus after cold preservation/Spleen"
TAG = "31892341_Spleen"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#########

folder = "/zp1/data/plyu3/UCSC/pmid31892341_ lung spleen esophagus after cold preservation/Esophagus"
TAG = "31892341_Esophagus"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)
###########

###
folder = "/zp1/data/plyu3/UCSC/pmid31950241_Human Testis integrated dataset"
TAG = "31950241_Human_Testis"
Read_Seurat_file_in_the_folder_UCSC(folder)
### Not work!!! #####


folder = "/zp1/data/plyu3/UCSC/pmid31996853_Cortical organoids/Organoids"
TAG = "31996853_Cortical_organoids"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid31996853_Cortical organoids/Primary"
TAG = "31996853_Cortical_primary"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 
folder = "/zp1/data/plyu3/UCSC/pmid32049002_Human multiple organoids and fetal brain"
TAG = "32049002_Human"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
to = "/zp1/data/plyu3/CellAnn_batch24/"
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


####
folder = "/zp1/data/plyu3/UCSC/pmid32066951_Colon immune cells"
TAG = "32066951_Colon"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

####
folder = "/zp1/data/plyu3/UCSC/pmid32079746_Fetal Thymus/Epithelial"
TAG = "32079746_Fetal_Thymus_Epithelial"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



folder = "/zp1/data/plyu3/UCSC/pmid32079746_Fetal Thymus/HSC"
TAG = "32079746_Fetal_Thymus_HSC"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

folder = "/zp1/data/plyu3/UCSC/pmid32079746_Fetal Thymus/MatureT"
TAG = "32079746_Fetal_Thymus_MatureT"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



folder = "/zp1/data/plyu3/UCSC/pmid32123174_Human Ovary"
TAG = "32123174_Human_Ovary"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#########
######## Next #######
##########
### red ####
### red #### something wrong !!! ######

### move to batch to = "/zp1/data/plyu3/CellAnn_batch8/"

folder = "/zp1/data/plyu3/UCSC/pmid32214235_Human cell landscape"
TAG = "32214235_Human_cell_landscape"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#####
folder = "/zp1/data/plyu3/UCSC/pmid32246845_Human lungs and HBECs in COVID-19 pathogenesis/Lung"
TAG = "32246845_Human_Lung"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid32246845_Human lungs and HBECs in COVID-19 pathogenesis/Airways"
TAG = "32246845_Human_Airways"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)




########
######## OK!!! Next is batch3 !!! ###########
########


cd /zp1/data/plyu3

mkdir /zp1/data/plyu3/CellAnn_batch3/

to = "/zp1/data/plyu3/CellAnn_batch3/"


#######
folder = "/zp1/data/plyu3/UCSC/pmid32398875_BALF immune cells in Covid19"
TAG = "32398875_BALF"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid32427931_Smoking Effect on Human Airway Epithelium"
TAG = "32427931_Smoking"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid32499656_Human macrophage development"
TAG = "32499656_Human_macrophage"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


####### red ###
to = "/zp1/data/plyu3/CellAnn_batch8/"
folder = "/zp1/data/plyu3/UCSC/pmid32591762_COVID-19 airways"
TAG = "32591762_COVID-19"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid32603604_Sputum cells from Cystic Fibrosis patients"
TAG = "32603604_Sputum"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid32726565_Human healthy airways"
TAG = "32726565_Human_airways"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid32764665_Covid19 cytokine storm"
TAG = "32764665_Covid19"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid32788748_COVID19 immune response"
TAG = "32788748_COVID19"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)




folder = "/zp1/data/plyu3/UCSC/pmid32832598_Pulmonary fibrosis lungs"
TAG = "32832598_Pulmonary"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### red ###### next round !!!! ########
####
####

folder = "/zp1/data/plyu3/UCSC/pmid32929266_endometrium cycle"
TAG = "32929266_endometrium"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#####



folder = "/zp1/data/plyu3/UCSC/pmid32946807_Human digestive tract"
TAG = "32946807_Human_digestive_tract"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


######

folder = "/zp1/data/plyu3/UCSC/pmid32968047_Human teeth"
TAG = "32968047_Human_teeth"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)




folder = "/zp1/data/plyu3/UCSC/pmid32971526_Adult human heart"
TAG = "32971526_human_heart"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



folder = "/zp1/data/plyu3/UCSC/pmid33140061_Oral cavity in COVID-19"
TAG = "33140061_Oral_cavity"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#####
##### some thing wrong !!!!!! ##################
#####

##### "red" #######
#####

folder = "/zp1/data/plyu3/UCSC/pmid33184181_Human fetal cell atlas"
TAG = "33184181_Human_fetal"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid33208946_Human Lung"
TAG = "33184181_Human_Lung"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid33259798_Human airway basal stem cells"
TAG = "33259798_Human_airway_basal"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

############# ##############
############# ##############
############# Next !!!! #####
############# ##############
############# ##############
#############


folder = "/zp1/data/plyu3/UCSC/pmid33290721_Developing human gut/Fetal"
TAG = "33290721_Developing_human_gut_Fetal"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)




folder = "/zp1/data/plyu3/UCSC/pmid33290721_Developing human gut/Pediatric"
TAG = "33290721_Developing_human_gut_Pediatric"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)





folder = "/zp1/data/plyu3/UCSC/pmid33361824_Nasal samples from COVID-19 patients with hypertension"
TAG = "33361824_Nasal"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



folder = "/zp1/data/plyu3/UCSC/pmid33479125_Healthy Human Skin"
TAG = "33479125_Human_Skin"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)




folder = "/zp1/data/plyu3/UCSC/pmid33713619_Immune cells in Severe Covid19/Adaptive"
TAG = "33713619_Immune_Adaptive"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)




folder = "/zp1/data/plyu3/UCSC/pmid33713619_Immune cells in Severe Covid19/Innate"
TAG = "33713619_Immune_Innate"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid33758880_Pediatric COVID PBMC and Nasal/PBMC"
TAG = "33758880_Pediatric_PBMC"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)




folder = "/zp1/data/plyu3/UCSC/pmid33758880_Pediatric COVID PBMC and Nasal/Nasal"
TAG = "33758880_Pediatric_Nasal"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


################# here !!!! yellow ########
###### Next !!!!! ######## yellow  ########
################# ######## yellow #########


folder = "/zp1/data/plyu3/UCSC/pmid33865984_Human cornea"
TAG = "33865984_Human_cornea"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### red ########################
#### red ########################
#### something wrong !!!!! ######
#### red ########################
#### red ########################

folder = "/zp1/data/plyu3/UCSC/pmid33879890_Covid19 PBMC"
TAG = "33879890_Covid19_PBMC"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

####
#### upper here something wrong !!! ####
####


folder = "/zp1/data/plyu3/UCSC/pmid33958799_Airway Epithelium in CF Patients"
TAG = "33958799_Airway_Epithelium"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

########
######## red #############
########


folder = "/zp1/data/plyu3/UCSC/pmid34035279_Human fetal pancreas and spheroids/Fetal"
TAG = "34035279_Human_fetal_pancreas_Fetal"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
to = "/zp1/data/plyu3/CellAnn_batch24/"
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#tmp = readRDS("/zp1/data/plyu3/CellAnn_batch24/pmid34035279_Human_fetal_pancreas_Fetal_avg_sub_mat")
#tmp = readRDS("/zp1/data/plyu3/UCSC/pmid34035279_Human fetal pancreas and spheroids/Fetal/pmid34035279_Fetal_seurat_obj_new")
#k = which(tmp$celltype_sub == "trunk@sub5")

#sub_celltype_avg = CellAnn_Avg_Mat(tmp[['RNA']]@data,tmp$celltype_sub)
#data_mat = tmp[['RNA']]@data
#data_cluster = tmp$celltype_sub

folder = "/zp1/data/plyu3/UCSC/pmid34035279_Human fetal pancreas and spheroids/Combined"
TAG = "34035279_Human_fetal_pancreas_Combined"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid34035279_Human fetal pancreas and spheroids/PP-spheroids"
TAG = "34035279_Human_fetal_pancreas_PP_spheroids"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid34051145_Human Hippocampal Axis"
TAG = "34051145_Human_Hippocampal"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



folder  = "/zp1/data/plyu3/UCSC/pmid34062119_multimodal PBMC"
TAG = "34062119_multimodal_PBMC"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)




folder = "/zp1/data/plyu3/UCSC/pmid34354210_Uninfected nasal mucosa across the lifespan"
TAG = "34354210_Uninfected_nasal"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



#### red ########################
#### red ########################
#### something wrong !!!!! ######
#### red ########################
#### red ########################

folder = "/zp1/data/plyu3/UCSC/pmid34497389_Healthy human gut"
TAG = "34497389_Healthy_human_gut"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

####
#### upper here something wrong !!! ####
####



folder = "/zp1/data/plyu3/UCSC/pmid35232959_Human fetal liver HSC"
TAG = "35232959_Human_fetal_liver"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid35438006_Human bronchial epithelial cells/Submerged"
TAG = "35438006_Human_bronchial_Submerged"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid35438006_Human bronchial epithelial cells/ALI"
TAG = "35438006_Human_bronchial_ALI"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid35523173_Human Forebrain Development"
TAG = "35523173_Human_Forebrain"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


###### we will update the database_sheet ############
######
###### OK!!! we copy these files from batch3 ########
######
###### pink ######
###### pink ######
###### pink ######
###### pink ######
###### pink ######
###### pink ######
###### pink ######
######
source("/zp1/data/plyu3/UCSC/Prepare_CellAnn_DB_final_source.R")


we will create a new folder 

cd /zp1/data/plyu3

mkdir /zp1/data/plyu3/CellAnn_batch4

to = "/zp1/data/plyu3/CellAnn_batch4/"


#### Not work!!! #####
#### process this one !!! #######
#### too big !!!!! ##############

folder = "/zp1/data/plyu3/UCSC/pmid35549310_Developing human immune system"
setwd(folder)

mat = Broad_matrix_process("exprMatrix.tsv")

TAG = "35549310_Developing_human_immune"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


####

folder = "/zp1/data/plyu3/UCSC/pmid35549406_Pan-immune/B-cell"
TAG = "35549406_B_cell"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



folder = "/zp1/data/plyu3/UCSC/pmid35549406_Pan-immune/Global"
TAG = "35549406_Pan_Global"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



folder = "/zp1/data/plyu3/UCSC/pmid35549406_Pan-immune/Myeloid"
TAG = "35549406_Myeloid"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = "/zp1/data/plyu3/UCSC/pmid35549406_Pan-immune/T-cell"
TAG = "35549406_T_cell"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#####

folder = "/zp1/data/plyu3/UCSC/pmid35820705_Alveolar Macrophage"
TAG = "35820705_Alveolar_Macrophage"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


###### no ? #######
######
######
folder = "/zp1/data/plyu3/UCSC/26430063_scRNA_Mouse Aging HSCs"
TAG = "26430063_Mouse_Aging_HSCs"
Read_Seurat_file_in_the_folder_UCSC(folder)


##### OK!!! to the old 1server 
##### OK!!! let us fill the datasets and go to the old server !!!! ########
#####
##### OK!!! let us process the other project !!! ##########################
#####

cd /home/plyu3/cell_ann_part_datasets1

mkdir pmid34642245_seurat_obj_folder
mv pmid34642245_seurat_obj pmid34642245_seurat_obj_folder/

to = "/zp1/data/plyu3/CellAnn_batch4/"


#### red #### at the new server ####
#### red ####
#### red ####


folder = "/home/plyu3/cell_ann_part_datasets1/pmid34642245_seurat_obj_folder"
TAG = "34642245"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#####
cd /home/plyu3/cell_ann_part_datasets1

mkdir pmid33444290_seurat_obj_folder
mv pmid33444290_seurat_obj pmid33444290_seurat_obj_folder/

folder = "/home/plyu3/cell_ann_part_datasets1/pmid33444290_seurat_obj_folder"
TAG = "33444290"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#####

cd /home/plyu3/cell_ann_part_datasets1

mkdir pmid32994417_seurat_obj_folder
mv pmid32994417_seurat_obj pmid32994417_seurat_obj_folder/

folder = "/home/plyu3/cell_ann_part_datasets1/pmid32994417_seurat_obj_folder"
TAG = "32994417"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#####
conda activate seurat4
to = "/zp1/data/plyu3/CellAnn_batch4/"

mkdir pmid32427356_seurat_obj_folder 
mv pmid32427356_seurat_obj pmid32427356_seurat_obj_folder/

folder = "/home/plyu3/cell_ann_part_datasets1/pmid32427356_seurat_obj_folder"
TAG = "32427356"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#####

folder = "/home/plyu3/cell_ann_part_datasets1/34584087_scRNA_Human Ocular_Sclera and Choroid"
TAG = "34584087_scRNA_Human_Ocular_Scler"

setwd(folder)

######
Broad_matrix_process <- function(file,sep="\t"){
	matrix = read.table(file,header=T,sep=sep)
	mat_input = as.matrix(matrix[,-1])
	rownames(mat_input) = matrix[,1]
	print(mat_input[1:5,1:5])
	#######
	return(mat_input)
}

mat_input = Broad_matrix_process("Matrix.txt")


Broad_cluster_process <- function(file){
	#####
	cluster = read.table(file,header=T,sep="\t")
	cluster = cluster[-1,]
	#####
	print(head(cluster))
	#####
	return(cluster)
}

colnames(cluster) <- c('cell','dim1','dim2','phase','celltype')

########
Broad_create_seurat_obj <- function(mat_input,cluster,file){
	######
	library(Seurat)
	###### saveRDS #######
	seurat_obj = CreateSeuratObject(mat_input)
	######
	m = match(colnames(seurat_obj),cluster[,1])
	cluster = cluster[m,]
	######
	head(cluster)
	head(colnames(seurat_obj))
	######
	seurat_obj@meta.data = cbind(seurat_obj@meta.data,cluster)
	######
	k = which(colnames(seurat_obj@meta.data) %in% c("dim1","dim2","dim3") == T)
	if(length(k) > 0){
		for(j in k){
			seurat_obj@meta.data[,j] = as.numeric(seurat_obj@meta.data[,j])
		}
	}
	######
	saveRDS(seurat_obj,file=file)
}

Broad_create_seurat_obj(mat_input,cluster,file="pmid_34584087_seurat_obj")



folder = "/home/plyu3/cell_ann_part_datasets1/34584087_scRNA_Human Ocular_Sclera and Choroid"
TAG = "34584087_scRNA_Human_Ocular_Scler"

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#####
############# OK!!!! ####################
#####

##### only one cell type !!!! ###########
#####
folder = "/home/plyu3/cell_ann_part_datasets1/34584087_scRNA_Human Ocular_RPE"
TAG = "34584087_scRNA_Human_Ocular_RPE"

setwd(folder)
mat_input = Broad_matrix_process("Matrix.txt")

cluster = Broad_cluster_process("Cluster.txt")
colnames(cluster) <- c('cell','dim1','dim2','phase','celltype')

Broad_create_seurat_obj(mat_input,cluster,file="pmid_34584087_RPE_seurat_obj")

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")


######
folder = "/home/plyu3/cell_ann_part_datasets1/34584087_scRNA_Human Ocular_Retina"
TAG = "34584087_scRNA_Human_Ocular_Retina"

setwd(folder)

mat_input = Broad_matrix_process("scp_Retina_expression.txt")
cluster = Broad_cluster_process("scp_Retina_coordinates.txt")

######## we add cell type to cluster !!!######
cluster2 = Broad_cluster_process("scp_metadata.txt")

colnames(cluster) <- c('cell','dim1','dim2')

m = match(cluster$cell,cluster2$NAME)

cluster$celltype = cluster2$Sub_celltype[m]

Broad_create_seurat_obj(mat_input,cluster,file="pmid_34584087_scRNA_Human_Ocular_Retina_seurat_obj")

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

to = "/zp1/data/plyu3/CellAnn_batch8/"


####



#######
#######

folder = "/home/plyu3/cell_ann_part_datasets1/34584087_scRNA_Human Ocular_Iris"
TAG = "34584087_scRNA_Human_Ocular_Iris"

setwd(folder)
mat_input = Broad_matrix_process("Matrix.txt")
cluster = Broad_cluster_process("Cluster.txt")

k = which(colnames(mat_input) %in% cluster[,1] == T)
colnames(cluster) <- c('cell','dim1','dim2','phase','celltype')

Broad_create_seurat_obj(mat_input,cluster,file="pmid_34584087_scRNA_Human_Iris_seurat_obj")

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


########
######## Next !!! ######

folder = "/home/plyu3/cell_ann_part_datasets1/34584087_scRNA_Human Ocular_Cornea"
TAG = "34584087_scRNA_Human_Ocular_Cornea"

setwd(folder)
mat_input = Broad_matrix_process("Matrix.txt")
cluster = Broad_cluster_process("Cluster.txt")
colnames(cluster) <- c('cell','dim1','dim2','phase','celltype')

Broad_create_seurat_obj(mat_input,cluster,file="pmid_34584087_scRNA_Human_Cornea_seurat_obj")

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

######## Next !!! ######



######## 
######## No matrix !!!! #########
folder = "/home/plyu3/cell_ann_part_datasets1/33711272_scRNA_Human renal cell carcinoma"
TAG = "33711272_Human_renal_cell_carcinoma"
setwd(folder)
mat_input = Broad_matrix_process("Matrix.txt")
cluster = Broad_cluster_process("Cluster.txt")
colnames(cluster) <- c('cell','dim1','dim2','phase','celltype')


######## 
folder = "/home/plyu3/cell_ann_part_datasets1/33664492_scRNA_Human prostate cancer"
TAG = "33664492_scRNA_Human_prostate_cancer"
setwd(folder)
mat_input = Broad_matrix_process("Matrix.txt")
cluster = Broad_cluster_process("Cluster.txt")

####
cluster$NAME = paste0("X",cluster$NAME)
colnames(cluster) <- c('cell','celltype','celltype2','dim1','dim2')

Broad_create_seurat_obj(mat_input,cluster,file="pmid_333664492_scRNA_Human_prostate_seurat_obj")
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

###### red #################
###### No matrix !!! #######
######

folder = "/home/plyu3/cell_ann_part_datasets1/33619488_scRNA_Human_Covid19 Nasal Swab"
TAG = "33619488_Covid19_Nasal_Swab"
setwd(folder)
mat_input = Broad_matrix_process("Matrix.txt")
cluster = Broad_cluster_process("Cluster.txt")


######
folder = "/home/plyu3/cell_ann_part_datasets1/32413319_scRNA_Mouse Nasal mucosa after interferon"
TAG = "32413319_Mouse_Nasal_mucosa"
setwd(folder)
mat_input = Broad_matrix_process("Matrix.csv",sep=",")
cluster = Broad_cluster_process("Cluster.txt")

cluster = cluster[,c(6,12)]
colnames(cluster) <- c('cell','celltype')
######
###### modify the UMAPs for these samples #########
######

Broad_create_seurat_obj(mat_input,cluster,file="pmid_32413319_Mouse_Nasal_mucosa_seurat_obj")
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


######
###### we need modify the umaps bu our selfs #######
######

folder = "/home/plyu3/cell_ann_part_datasets1/32251406_scRNA_Human PBMC pre and post HIV"
TAG = "32251406_PBMC_HIV"
setwd(folder)
mat_input = Broad_matrix_process("Matrix.txt.gz")
cluster = Broad_cluster_process("Cluster.txt")

cluster = cluster[,c(1,8)]
colnames(cluster) <- c('cell','celltype')
Broad_create_seurat_obj(mat_input,cluster,file="pmid_32251406_PBMC_HIV_seurat_obj")

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#######
####### yellow #######
#######

#######
####### OK!!! then the next !!!! #######
####### next we will start to batch5 !!! ######
#######

conda activate seurat4
to = "/zp1/data/plyu3/CellAnn_batch5/"

source("/zp1/data/plyu3/UCSC/Prepare_CellAnn_DB_final_source.R")



########## ok!!! #######
########## we start here !!! ######
folder = "/home/plyu3/cell_ann_part_datasets1/30526881_scRNA_Human Cultured Small intestinal organoids"
TAG = "30526881_Human_intestinal_organoids"
setwd(folder)


mat_input = Broad_matrix_process("Matrix.csv.gz",sep=",")
cluster = Broad_cluster_process("Cluster.csv",sep=',')

cluster = cluster[,c(1,4,2,3)]
colnames(cluster) <- c('cell','celltype','dim1','dim2')
Broad_create_seurat_obj(mat_input,cluster,file="30526881_Human_intestinal_organoids_seurat_obj")

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

########### OK!!! next 2 ######
mkdir /zp1/data/plyu3/CellAnn_batch5/

mkdir /home/plyu3/cell_ann_part_datasets1/30382198_scRNA_Mouse_Neocortex_LGD
mkdir /home/plyu3/cell_ann_part_datasets1/30382198_scRNA_Mouse_Neocortex_ALM

cp /home/plyu3/cell_ann_part_datasets1/30382198_scRNA_Mouse_Neocortex/*LGd* /home/plyu3/cell_ann_part_datasets1/30382198_scRNA_Mouse_Neocortex_LGD/
cp /home/plyu3/cell_ann_part_datasets1/30382198_scRNA_Mouse_Neocortex/Matrix_lateral geniculate complex.txt /home/plyu3/cell_ann_part_datasets1/30382198_scRNA_Mouse_Neocortex_LGD/
cp /home/plyu3/cell_ann_part_datasets1/30382198_scRNA_Mouse_Neocortex/'Cluster_lateral geniculate complex.txt' /home/plyu3/cell_ann_part_datasets1/30382198_scRNA_Mouse_Neocortex_LGD/

cp 'Cluster_anterior lateral motor.txt' /home/plyu3/cell_ann_part_datasets1/30382198_scRNA_Mouse_Neocortex_ALM/
cp 'Matrix_anterior lateral motor.txt' /home/plyu3/cell_ann_part_datasets1/30382198_scRNA_Mouse_Neocortex_ALM/


folder = "/home/plyu3/cell_ann_part_datasets1/30382198_scRNA_Mouse_Neocortex_LGD"
TAG = "30382198_Mouse_Neocortex_LGD"
setwd(folder)


##### #####
mat_input = Broad_matrix_process("Matrix_lateral geniculate complex.txt",sep="\t")
colnames(mat_input) = gsub('.','-',colnames(mat_input),fixed=T)
cluster = Broad_cluster_process("Cluster_lateral geniculate complex.txt",sep='\t')
cluster = cluster[,c(1,2)]
colnames(cluster) <- c('cell','celltype')

k = which(colnames(mat_input) %in% cluster$cell == T)

Broad_create_seurat_obj(mat_input,cluster,file="330382198_Mouse_Neocortex_LGD_seurat_obj")

### tmp = readRDS("330382198_Mouse_Neocortex_LGD_seurat_obj")
input_folder = folder
Read_Seurat_file_in_the_folder_UCSC(folder)
### 
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



###### seurat_obj <- readRDS('pmid30382198LGd_seurat_obj')

folder = "/home/plyu3/cell_ann_part_datasets1/30382198_scRNA_Mouse_Neocortex_ALM"
TAG = "30382198_Mouse_Neocortex_ALM"
setwd(folder)
mat_input = Broad_matrix_process("Matrix_anterior lateral motor.txt",sep=",")
colnames(mat_input) = gsub('.','-',colnames(mat_input),fixed=T)
cluster = Broad_cluster_process("Cluster_anterior lateral motor.txt",sep="\t")
cluster = cluster[,c(1,2)]
colnames(cluster) <- c('cell','celltype')
Broad_create_seurat_obj(mat_input,cluster,file="330382198_Mouse_Neocortex_ALM_seurat_obj")

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")

input_folder = folder

Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

####### OK!!! #####
####### Next3 ######


folder = "/home/plyu3/cell_ann_part_datasets1/27806376_scRNA_Human Oligodendroglioma"
TAG = "27806376_Oligodendroglioma"
setwd(folder)
mat_input = Broad_matrix_process("Matrix.txt",sep="\t")
#colnames(mat_input) = gsub('.','-',colnames(mat_input),fixed=T)
cluster = Broad_cluster_process("Cluster.txt",sep="\t")
cluster = cluster[,c(1,2)]
colnames(cluster) <- c('cell','celltype')

Broad_create_seurat_obj(mat_input,cluster,file="27806376_Oligodendroglioma_seurat_obj")

Read_Seurat_file_in_the_folder_UCSC(folder)

Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


####### OK!!! #####
####### Next4 ######

folder = "/home/plyu3/cell_ann_part_datasets1/27565351_scRNA_Mouse Retinal Bipolar Neuron"
TAG = "27565351_Mouse_Retinal_Bipolar"
setwd(folder)
mat_input = Broad_matrix_process("Matrix.txt",sep="\t")
cluster = Broad_cluster_process("Cluster.txt",sep="\t")
cluster = cluster[,c(1,2)]
colnames(cluster) <- c('cell','celltype')

Broad_create_seurat_obj(mat_input,cluster,file="27565351_Mouse_Retinal_Bipolar_seurat_obj")

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#######
####### Next5 ######
#######

folder = "/home/plyu3/cell_ann_part_datasets1/27471252_snRNA_Adult Mouse Hippocampus"
TAG = "27471252_Mouse_Hippocampus"
setwd(folder)
mat_input = Broad_matrix_process("Matrix.txt",sep="\t")
cluster = Broad_cluster_process("Cluster.txt",sep="\t")
cluster = cluster[,c(1,2)]
colnames(cluster) <- c('cell','celltype')
Broad_create_seurat_obj(mat_input,cluster,file="27471252_Mouse_Hippocampus_seurat_obj")

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



###### OK!!! #######
###### Next !!!!!###
######

folder = "/home/plyu3/cell_ann_part_datasets1/27124452_scRNA_Human Metastatic Melanoma"
TAG = "27124452_Mouse_Melanoma"
setwd(folder)
mat_input = Broad_matrix_process("Matrix.txt",sep="\t")
cluster = Broad_cluster_process("Cluster.txt",sep="\t")
cluster = cluster[,c(1,2)]
colnames(cluster) <- c('cell','celltype')
Broad_create_seurat_obj(mat_input,cluster,file="27124452_Mouse_Melanoma_seurat_obj")


Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

##### Next !!!!

folder = "/home/plyu3/cell_ann_part_datasets1/26727548_scRNA_Adult Mouse Visual Cortex"
TAG = "26727548_Mouse_Visual"
setwd(folder)
mat_input = Broad_matrix_process("Matrix.txt",sep="\t")
cluster = Broad_cluster_process("Cluster.txt",sep="\t")
cluster = cluster[,c(1,2)]
colnames(cluster) <- c('cell','celltype')
Broad_create_seurat_obj(mat_input,cluster,file="26727548_Mouse_Visual_seurat_obj")

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

##### ######### ################ ##########
##### Next !!!!! don't need this !!!!! ####
folder = "/home/plyu3/cell_ann_part_datasets1/26430063_scRNA_Mouse Aging HSCs"
TAG = "26430063_Mouse_HSCs"
setwd(folder)

#####
##### Next !!!!! ########
#####

folder = "/home/plyu3/cell_ann_part_datasets1/33777933_bone_marrow"
TAG = "33777933_bone_marrow"
setwd(folder)

mat_input = Broad_matrix_process("counts.normalized.csv.gz",sep=",")
cluster = Broad_cluster_process("metadata.csv",sep=",")

tail(colnames(mat_input))
tail(cluster)
#####
cluster = cluster[,c(1,4,2,3)]
colnames(cluster) <- c('cell','celltype','dim1','dim2')
Broad_create_seurat_obj(mat_input,cluster,file="26430063_Mouse_HSCs_seurat_obj")
##### 
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)





######
folder = "/home/plyu3/cell_ann_part_datasets1/33619488_Human_Nasal_swabs"
TAG = "33619488_Human_Nasal_swabs"
setwd(folder)
###### OK!! then we start !! ######

file = "20210220_NasalSwab_RawCounts.txt"

##### ADD A \T AT THE START OF THE MATRIX #######
matrix = read_delim(file,delim="\t")

mat_input = Broad_matrix_process("20210220_NasalSwab_NormCounts.txt",sep="\t")
cluster = Broad_cluster_process("20210220_NasalSwab_UMAP.txt",sep="\t")

cluster = cluster[,c(1,4,2,3)]
colnames(cluster) <- c('cell','celltype','dim1','dim2')
Broad_create_seurat_obj(mat_input,cluster,file="26430063_Mouse_HSCs_seurat_obj")

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


##### OK!!! next !!!! ######
#####
##### cd 31995762_total
mkdir /home/plyu3/cell_ann_part_datasets1/31995762_total
folder = "/home/plyu3/cell_ann_part_datasets1/31995762_total"
setwd(folder)


file = "PRJ0027145_ex.txt"
mat_input = Broad_matrix_process("PRJ0027145_ex.txt",sep="\t")
load('mat_input')

cluster = Broad_cluster_process("PRJ0027145_meta.txt",sep="\t")
table(cluster$Clusters_RPE)
table(cluster$Cell_type_full)

#### OK!!! let us use all first ######
####

dims = Broad_cluster_process("Clusters_full_tSNE.txt",sep=",")
m = match(dims$Clusters_full,cluster$Clusters_full)
dims$celltype = cluster$Cell_type_full[m]

dims = dims[,c(1,5,2,3)]
colnames(dims) <- c('cell','celltype','dim1','dim2')
Broad_create_seurat_obj(mat_input,dims,file="31995762_total_seurat_obj")

#### next: BC 
dims = Broad_cluster_process("Clusters_bipolar_tSNE.txt",sep=",")
m = match(dims$Clusters_bipolar,cluster$Clusters_bipolar)
dims$celltype = cluster$Cell_type_bipolar[m]
dims = dims[,c(1,5,2,3)]
colnames(dims) <- c('cell','celltype','dim1','dim2')

Broad_create_seurat_obj(mat_input,dims,file="31995762_BC_seurat_obj")

#### next: AC
dims = Broad_cluster_process("Clusters_amacrine_tSNE.txt",sep=",")
m = match(dims$Clusters_amacrine,cluster$Clusters_amacrine)
dims$celltype = cluster$Cell_type_amacrine[m]
dims = dims[,c(1,5,2,3)]
colnames(dims) <- c('cell','celltype','dim1','dim2')

Broad_create_seurat_obj(mat_input,dims,file="31995762_AC_seurat_obj")


#### RGC 
####

dims = Broad_cluster_process("Clusters_rgc_tSNE.txt",sep=",")
m = match(dims$Clusters_rgc,cluster$Clusters_rgc)
dims$celltype = cluster$Cell_type_rgc[m]
dims = dims[,c(1,5,2,3)]
colnames(dims) <- c('cell','celltype','dim1','dim2')

Broad_create_seurat_obj(mat_input,dims,file="31995762_RGC_seurat_obj")

#### HC
dims = Broad_cluster_process("Clusters_horizontal_tSNE.txt",sep=",")
m = match(dims$Clusters_horizontal,cluster$Clusters_horizontal)
dims$celltype = cluster$Cell_type_horizontal[m]
table(dims$celltype)
dims = dims[,c(1,5,2,3)]
colnames(dims) <- c('cell','celltype','dim1','dim2')
head(dims)
Broad_create_seurat_obj(mat_input,dims,file="31995762_HC_seurat_obj")


#### Cone
dims = Broad_cluster_process("Clusters_cones_tSNE.txt",sep=",")
m = match(dims$Clusters_cones,cluster$Clusters_cones)
dims$celltype = cluster$Cell_type_cones[m]
table(dims$celltype)
dims = dims[,c(1,5,2,3)]
colnames(dims) <- c('cell','celltype','dim1','dim2')
head(dims)
Broad_create_seurat_obj(mat_input,dims,file="31995762_Cone_seurat_obj")

#### 
dims = Broad_cluster_process("Clusters_myeloid_tSNE.txt",sep=",")
m = match(dims$Clusters_myeloid,cluster$Clusters_myeloid)
dims$celltype = cluster$Cell_type_myeloid[m]
table(dims$celltype)
dims = dims[,c(1,5,2,3)]
colnames(dims) <- c('cell','celltype','dim1','dim2')
head(dims)
Broad_create_seurat_obj(mat_input,dims,file="31995762_myeloid_seurat_obj")
####
#### OK!! create new folder !!! ####
####
mkdir /home/plyu3/cell_ann_part_datasets1/31995762_myeloid
mkdir /home/plyu3/cell_ann_part_datasets1/31995762_Cone
mkdir /home/plyu3/cell_ann_part_datasets1/31995762_HC
mkdir /home/plyu3/cell_ann_part_datasets1/31995762_RGC
mkdir /home/plyu3/cell_ann_part_datasets1/31995762_AC
mkdir /home/plyu3/cell_ann_part_datasets1/31995762_BC

cd /home/plyu3/cell_ann_part_datasets1/31995762_total
mv 31995762_AC_seurat_obj  /home/plyu3/cell_ann_part_datasets1/31995762_AC/
mv 31995762_BC_seurat_obj  /home/plyu3/cell_ann_part_datasets1/31995762_BC/
mv 31995762_HC_seurat_obj  /home/plyu3/cell_ann_part_datasets1/31995762_HC/

mv 31995762_myeloid_seurat_obj  /home/plyu3/cell_ann_part_datasets1/31995762_myeloid/
mv 31995762_RGC_seurat_obj  /home/plyu3/cell_ann_part_datasets1/31995762_RGC/
mv 31995762_Cone_seurat_obj  /home/plyu3/cell_ann_part_datasets1/31995762_Cone/

#### 8 !!! ##

folder = '/home/plyu3/cell_ann_part_datasets1/31995762_total'
TAG = '31995762_total'
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

folder = '/home/plyu3/cell_ann_part_datasets1/31995762_AC'
TAG = '31995762_AC'
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

folder = '/home/plyu3/cell_ann_part_datasets1/31995762_BC'
TAG = '31995762_BC'
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

folder = '/home/plyu3/cell_ann_part_datasets1/31995762_Cone'
TAG = '31995762_Cone'
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = '/home/plyu3/cell_ann_part_datasets1/31995762_HC'
TAG = '31995762_HC'
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


folder = '/home/plyu3/cell_ann_part_datasets1/31995762_myeloid'
TAG = '31995762_myeloid'
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

folder = '/home/plyu3/cell_ann_part_datasets1/31995762_RGC'
TAG = '31995762_RGC'
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


####
#### OK!!! next !!!! ########
Cell Atlas of The Human Fovea and Peripheral Retina
mkdir 32555229_Human_Fovea_Peripheral

folder = "/home/plyu3/cell_ann_part_datasets1/32555229_Human_Fovea_Peripheral"
TAG = "32555229_Human_Fovea_Peripheral"
setwd(folder)

mat_input = Broad_matrix_process("Human_retina_combined_all_expression_matrix.csv",sep=",")
cluster = Broad_cluster_process("Human_retina_combined_all_meta.csv",sep=",")

####

tail(colnames(mat_input))
tail(cluster)
#####
cluster = cluster[,c(1,2)]
colnames(cluster) <- c('cell','celltype')
Broad_create_seurat_obj(mat_input,cluster,file="32555229_Human_Fovea_Peripheral_seurat_obj")
##### 
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)





#### OK!!! next !!!! ########
#### Single-Cell Analysis of Human Retina Identifies Evolutionarily Conserved and Species-Specific Mechanisms Controlling Development
Single cell RNA sequencing of human liver reveals distinct intrahepatic macrophage populations
mkdir 30348985_human_liver


folder = "/home/plyu3/cell_ann_part_datasets1/30348985_human_liver"
TAG = "30348985_human_liver"
setwd(folder)

mat_input = Broad_matrix_process("GSE115469_Data.csv",sep=",")
cluster = Broad_cluster_process("GSE115469_CellClusterType.txt",sep="\t")

tail(colnames(mat_input))
tail(cluster)
#####
cluster = cluster[,c(1,5)]
#colnames(cluster) <- c('cell','celltype','dim1','dim2')
colnames(cluster) <- c('cell','celltype')

Broad_create_seurat_obj(mat_input,cluster,file="30348985_human_liver_seurat_obj")
##### 
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)














####
#### OK!!! next !!!! ########
#### 
A human liver cell atlas reveals heterogeneity and epithelial progenitors
PMID: 31292543

nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/0b139068-19fc-4b70-a235-dcd0bdbb11e9/local.rds?AWSAccessKeyId=ASIATLYQ5N5XY3VU2LUX&Signature=AxfAr7I8bj%2Fx8zZW3MK8vGy3ESU%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEAoaCXVzLXdlc3QtMiJHMEUCIHgUBB9E7GN5RcPdojPIAbgdBfqxwnYkoGvnQ0Q0eEXNAiEA4fp1xv0up2DSf3sKLjEeopyRv1s%2Ft4jbAPVInpOEvMwq9AMIg%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARABGgwyMzE0MjY4NDY1NzUiDELRTonoTbDsCL6jfCrIAxQbD57FnPco2vffrlf32kb6Uk3zMzn5sg%2B0LIR1v4t3GpTRbRORGkhhUJgdlEcjAi0K3IyXuSgon%2BIw16qI3UlcGnEpfM384%2B2SPHG5e3Lt30HEZPrLZnbUk4gV%2BhmsrCzqnTtqsJsYL17B5ye8mwYUTwqznllGPUspbA5gRw8CRCUpW2V%2FsU%2Be0Pj71DnbUF4lgUAD5pt3JSP%2F%2Fl6MtMX9fklfkh8hWigi6vltmue%2F4ztzDltIQB1kXGx%2FituN1zAhjYtMuI5tQLIc9Vc7B1tdTiEq5WYIt0TYeB%2BTVSbdoBdWooRu5YToa%2BG9zrTtbiC3fK8Zq5jhSJUEsaMIuU7X2EyMqJpGz1lBmqnkS%2B7jewqSdmY4PU085DMjdoF0eBtNQvTix5HOwKdLv8uY8KOJ6MKDoimyNgg3Nu11DxdOoOCDYCf7IYpjkERgaUCaXkUjXQ1FFyo64eIW0UWh6%2B8trMKT2v%2B6aLkFcUDeC%2FC3%2FcZW5CUfcUcUZSu32TzPB7lH9jaKm61Xq16%2FoS1BMyn20crB%2F8hC%2B4b11URC6tOsE%2FcmfuRZlCCrjOCpF5bnxt7PwyN4wi%2BFzHxq73RlKowovPZYc9z2BTDIw9yeBjqlATxT0CCJaxBZ8hLAuPfXLK6w%2Bud1B%2BwQsIJrT8hL%2B23UqE5FKqqtEZ5RxpDH77xZhRDlkFOlofAMOElK6Jzkbw6PEvHNimxAiBZScs8NDLAp1veCYJ9wJ5tf2s4j1g8tkRGbxVHjFS7BE8wX7Vl4%2FJI2dUOxrUk0Fb%2FP5wUDIWl5QdLPvcVPDjH7MKMfYNuIsiuEB5GCUH%2BZzFhE1%2BUNwuojF0JFzQ%3D%3D&Expires=1675649827" &

#### OK!!! next !!!! ##########
Mapping the developing human immune system across organs
PMID: 35549310

mkdir 35549310_human_immune_system
cd 35549310_human_immune_system
nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/a7a1aa72-a6ea-4044-9e50-c32b0ca5cbb6/local.rds?AWSAccessKeyId=ASIATLYQ5N5XY3VU2LUX&Signature=EUcEZvDuxrmQo10D3L%2BEMVveBC0%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEAoaCXVzLXdlc3QtMiJHMEUCIHgUBB9E7GN5RcPdojPIAbgdBfqxwnYkoGvnQ0Q0eEXNAiEA4fp1xv0up2DSf3sKLjEeopyRv1s%2Ft4jbAPVInpOEvMwq9AMIg%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARABGgwyMzE0MjY4NDY1NzUiDELRTonoTbDsCL6jfCrIAxQbD57FnPco2vffrlf32kb6Uk3zMzn5sg%2B0LIR1v4t3GpTRbRORGkhhUJgdlEcjAi0K3IyXuSgon%2BIw16qI3UlcGnEpfM384%2B2SPHG5e3Lt30HEZPrLZnbUk4gV%2BhmsrCzqnTtqsJsYL17B5ye8mwYUTwqznllGPUspbA5gRw8CRCUpW2V%2FsU%2Be0Pj71DnbUF4lgUAD5pt3JSP%2F%2Fl6MtMX9fklfkh8hWigi6vltmue%2F4ztzDltIQB1kXGx%2FituN1zAhjYtMuI5tQLIc9Vc7B1tdTiEq5WYIt0TYeB%2BTVSbdoBdWooRu5YToa%2BG9zrTtbiC3fK8Zq5jhSJUEsaMIuU7X2EyMqJpGz1lBmqnkS%2B7jewqSdmY4PU085DMjdoF0eBtNQvTix5HOwKdLv8uY8KOJ6MKDoimyNgg3Nu11DxdOoOCDYCf7IYpjkERgaUCaXkUjXQ1FFyo64eIW0UWh6%2B8trMKT2v%2B6aLkFcUDeC%2FC3%2FcZW5CUfcUcUZSu32TzPB7lH9jaKm61Xq16%2FoS1BMyn20crB%2F8hC%2B4b11URC6tOsE%2FcmfuRZlCCrjOCpF5bnxt7PwyN4wi%2BFzHxq73RlKowovPZYc9z2BTDIw9yeBjqlATxT0CCJaxBZ8hLAuPfXLK6w%2Bud1B%2BwQsIJrT8hL%2B23UqE5FKqqtEZ5RxpDH77xZhRDlkFOlofAMOElK6Jzkbw6PEvHNimxAiBZScs8NDLAp1veCYJ9wJ5tf2s4j1g8tkRGbxVHjFS7BE8wX7Vl4%2FJI2dUOxrUk0Fb%2FP5wUDIWl5QdLPvcVPDjH7MKMfYNuIsiuEB5GCUH%2BZzFhE1%2BUNwuojF0JFzQ%3D%3D&Expires=1675650212" &

#### OK!!! next !!!! ##########





#### OK!!! next !!!! #######
####
A cell atlas of human thymic development defines T cell repertoire formation
PMID: 32079746

mkdir 32079746_human_thymic
cd 32079746_human_thymic
curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/0b139068-19fc-4b70-a235-dcd0bdbb11e9/local.rds?AWSAccessKeyId=ASIATLYQ5N5XWRWFR6PE&Signature=0NY7CJt2XfXpDR4McPoJJKtwIuo%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEAoaCXVzLXdlc3QtMiJGMEQCIECHA981gvQycoTP%2BN9ttLpE67HayMM6H1ZwKTk92yMZAiBlO3hwsHDno8gVAUej%2BBY1%2BfaLpgxgy%2FwClh5Q6tkCQCr0AwiD%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAEaDDIzMTQyNjg0NjU3NSIMyT7T7fGtwfLcz880KsgDowIxOonbHl81qDlGlINZArD1gAMjCPjqIRE5fats4rhwZeI175lSdTI1pDR5EtciJYikcLPg09h%2BRJPOX9amQ3r2V%2BGd%2FmXj8YBU5XzKbie2JHCGELcxysznKmmIcXvmuRcGaOG1MY22Y%2Btj5Zsv5Hw%2Bx%2B4gU5XIxo5VKTOWctjgXMdiTIgeIyWbIUIocqTY%2BHt8mcNpt3AXX96K0ktCsno6DjWjXE%2Ff2IFyj5jtYRnhrlH%2FYb9NGKehjuMhZz0QruCfARY4hztzkMmghlk%2Fjvexhh8DvuXNU2Os2r4jMOC3nigiuUMc9schprxfW1l72pARm%2FqLy0%2FIb4NLQppD6n%2F3CUTcytvS%2Bsj9416c3rtXlAnKuzet9Hr6B%2F3nPghMfY1qsKcRAsYMMdDFgL%2BFznUfrkuUkqDdkZDDxOTR%2B923jGpBfMaIlOuXZWfUti6v7PIL8G89m7OWOAXQzJH%2FiuPoGbxTSTYJkUfUpBJ0B3QClM1KC3ddBL4jxkt%2Fgpg%2FXPfz9d6rZWvDMQQFtWV5a2glFdnFLSZz4hq0dYnw4yGzaHwDgJNwNORTaQ%2F23VsW9Y1LoH6QqaHmxpPK%2FFu7zLj2DbtxXU0wML653J4GOqYBH%2BMFTlI5E%2FCWF2hwYiM9arFzDW513HwTYD4qWCswogZ05db6I4KZXW%2BH0Wz6%2BbNwq21ON5EF%2FP0ENyhskUzC4FpsqmGIMQ6jLgYZelpgxIcsGXuFjotMXSBnDPOwoQuRVgJHy33n4DHIDSbJTl5Fu7b%2BZqVSknJ68ftMhLAHB8eJTXKnz32yOBFpzilKHSrovr0CofVl5Ncyvwl1uLAurCRNvFHcBQ%3D%3D&Expires=1675649670"








####
####
#### OK!!! then we will found the next thing ########
####


scp -r /zp1/data/yzhai11/UCSC plyu3@omb2.onc.jhmi.edu:/zp1/data/plyu3/UCSC_old

mkdir /zp1/data/plyu3/CellAnn_batch6/

conda activate seurat4

to = "/zp1/data/plyu3/CellAnn_batch6/"

source("/zp1/data/plyu3/UCSC/Prepare_CellAnn_DB_final_source.R")
source("/zp1/data/plyu3/UCSC/Prepare_CellAnn_DB_final_add1.R")

setwd('/zp1/data/plyu3/UCSC_old')

##### No.1 #####
#####
to = "/zp1/data/plyu3/CellAnn_batch6/"

##### ################## #####

##### red ######
##### red ######


folder = "/zp1/data/plyu3/UCSC_old/pmid23193282Cortex"
TAG = "23193282Cortex_Human"

##### ################## #####
Read_Seurat_file_in_the_folder_UCSC(folder)
#####
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#####
##### red ######
#####

folder = "/zp1/data/plyu3/UCSC_old/pmid23193282Motor"
TAG = "23193282Motor"

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

##################
##### red ######
##################

folder = "/zp1/data/plyu3/UCSC_old/pmid28965763"
TAG = "28965763_Human_Pancreas"

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
setwd(folder)
tmp = readRDS("pmid28965763_seurat_obj")
k = which(is.na(tmp$celltype) == T)
tmp = tmp[,-k]
input_folder = folder
saveRDS(tmp,file="pmid28965763_seurat_obj")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


################
################
################


folder = "/zp1/data/plyu3/UCSC_old/pmid30315278"
TAG = "28965763_Human_testis"

input_folder = folder
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### red #####

folder = "/zp1/data/plyu3/UCSC_old/pmid30348985"
TAG = "30348985_Human_Liver"

input_folder = folder
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### red #####

folder = "/zp1/data/plyu3/UCSC_old/pmid30355494"
TAG = "30355494_Human_Skin"

input_folder = folder
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### red #####

folder = "/zp1/data/plyu3/UCSC_old/pmid30429548"
TAG = "30355494_Human_Reproductive_system"

input_folder = folder
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### red #####

folder = "/zp1/data/plyu3/UCSC_old/pmid30566875"
TAG = "30566875_Human_Prostate"

input_folder = folder
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)

Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#####
##### ####### ######
##### 4 #####
#####

folder = "/zp1/data/plyu3/UCSC_old/pmid30726734"
TAG = "30726734_Human_testis"
#####
##### # #####
#####

input_folder = folder
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 1 ######
folder = "/zp1/data/plyu3/UCSC_old/pmid30747918"
TAG = "30747918_Human_white_matter"

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 3 ######
folder = "/zp1/data/plyu3/UCSC_old/pmid31075224"
TAG = "31075224_Human_eye"

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


setwd("/zp1/data/plyu3/UCSC_old/pmid31075224")

seurat_obj <- readRDS("pmid31075224_seurat_obj_new")
seurat_obj <- FindNeighbors(seurat_obj,reduction='dims',dims=1:2)
seurat_obj <- FindClusters(seurat_obj,reduction=0.3)

devtools::source_url("https://raw.githubusercontent.com/Pinlyu3/CellAnn/main/prepare_CellAnn.R")

prepare_CellAnn(seurat_obj,folder="/zp1/data/plyu3/UCSC_old/pmid31075224",sample_name='pmid31075224_eye_test',matrix_name='RNA',dims='dims',cluster='seurat_clusters')




#### 4 ######

folder = "/zp1/data/plyu3/UCSC_old/pmid31209336bronchi"
TAG = "31075224_Human_Lung_bronchi"

setwd(folder)

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


##### 1 #####


folder = "/zp1/data/plyu3/UCSC_old/pmid31209336epithelial"
TAG = "31075224_Human_Lung_epithelial"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


##### 3 #####


folder = "/zp1/data/plyu3/UCSC_old/pmid31209336nasal"
TAG = "31075224_Human_Lung_nasal"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

##### 4 #####

folder = "/zp1/data/plyu3/UCSC_old/pmid31209336parenchyma"
TAG = "31075224_Human_Lung_parenchyma"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


##### 3 ######


folder = "/zp1/data/plyu3/UCSC_old/pmid31316211"
TAG = "31075224_Human_Brain"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


##### 4 ##

folder = "/zp1/data/plyu3/UCSC_old/pmid31341279"
TAG = "31341279_Mouse_Heart"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 1 ###

folder = "/zp1/data/plyu3/UCSC_old/pmid31436334"
TAG = "31436334_Human_eye"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 5 ###


folder = "/zp1/data/plyu3/UCSC_old/pmid31474370"
TAG = "31474370_Human_Intestine"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 4 ####

folder = "/zp1/data/plyu3/UCSC_old/pmid31604275Fetal"
TAG = "31604275_Human_Fetal_kidney"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 1 ####

folder = "/zp1/data/plyu3/UCSC_old/pmid31604275Mature"
TAG = "31604275_Human_Mature_kidney"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 6 #####

folder = "/zp1/data/plyu3/UCSC_old/pmid31712411"
TAG = "31712411_Human_Eye"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### 5 ######
folder = "/zp1/data/plyu3/UCSC_old/pmid31753849Colon"
TAG = "31753849Colon"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 5 ####
folder = "/zp1/data/plyu3/UCSC_old/pmid31753849Ileum"
TAG = "31753849Ileum"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 5 ###
folder = "/zp1/data/plyu3/UCSC_old/pmid31753849Rectum"
TAG = "31753849Rectum"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 1 ###
folder = "/zp1/data/plyu3/UCSC_old/pmid32066951"
TAG = "32066951_Human_Intestine"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### 2 ###
folder = "/zp1/data/plyu3/UCSC_old/pmid32109386"
TAG = "32109386_Human_Lung"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

### 3 ###

folder = "/zp1/data/plyu3/UCSC_old/pmid32123174"
TAG = "32123174_Human_ovarian"

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

### 4 ###
folder = "/zp1/data/plyu3/UCSC_old/pmid32327715"
TAG = "32327715_Human_skin"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#########
### 1 ###
#########
folder = "/zp1/data/plyu3/UCSC_old/pmid32396864Adult"
TAG = "32396864_Human_Muscle"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#########
#########
### 2 ###
#########

folder = "/zp1/data/plyu3/UCSC_old/pmid32396864Embryonic"
TAG = "32396864_Human_Embryonic_Hindlimb_Muscle"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


##########
### 1 ####
##########

folder = "/zp1/data/plyu3/UCSC_old/pmid32396864Fetal"
TAG = "32396864_Human_Fetal_Hindlimb_Muscle"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### 2 ###
folder = "/zp1/data/plyu3/UCSC_old/pmid32396864Juvenile"
TAG = "32396864_Human_Juvenile_Hindlimb_Muscle"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### 3 ###
folder = "/zp1/data/plyu3/UCSC_old/pmid32499656"
TAG = "32499656_human_blood"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 4 ###
folder = "/zp1/data/plyu3/UCSC_old/pmid32514174"
TAG = "32514174_human_PBMC"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 5 ####
folder = "/zp1/data/plyu3/UCSC_old/pmid32527923"
TAG = "32527923_human_Brain"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 1 ######
folder = "/zp1/data/plyu3/UCSC_old/pmid32624006"
TAG = "32624006_human_Muscle"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### 2 ####
folder = "/zp1/data/plyu3/UCSC_old/pmid32651212"
TAG = "32651212_Human_Blood"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### 3 ####

folder = "/zp1/data/plyu3/UCSC_old/pmid32728211"
TAG = "32728211_Mouse_skin"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### 3 ####

folder = "/zp1/data/plyu3/UCSC_old/pmid32887883"
TAG = "32887883_Mouse_Brain"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 1 #####

folder = "/zp1/data/plyu3/UCSC_old/pmid33321047ASE"
TAG = "33321047ASE"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### 4 ######
folder = "/zp1/data/plyu3/UCSC_old/pmid33321047ASE"
TAG = "33321047SLAE"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### #####
#### 5 ###
folder = "/zp1/data/plyu3/UCSC_old/pmid33448928"
TAG = "33448928_Mouse_Kidney"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### 1 #####
folder = "/zp1/data/plyu3/UCSC_old/pmid33730024"
TAG = "33730024_Human_airway"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### 4 #####

folder = "/zp1/data/plyu3/UCSC_old/pmid33850129"
TAG = "33850129_Human_kidney"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

### 5 #####
folder = "/zp1/data/plyu3/UCSC_old/pmid33958799"
TAG = "33958799_Human_airway"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

### 3 #####
folder = "/zp1/data/plyu3/UCSC_old/pmid34004146"
TAG = "34004146_Mouse_Brain"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

### 4 ######
folder = "/zp1/data/plyu3/UCSC_old/pmid34494546"
TAG = "34494546_Mouse_Brain"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

### 
### 1 ######
###

folder = "/zp1/data/plyu3/UCSC_old/pmid34497421"
TAG = "34497421_Human_Brain"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


###
### 2 ######
###
folder = "/zp1/data/plyu3/UCSC_old/pmid34616070Neocortex"
TAG = "34616070_Neocortex"
Read_Seurat_file_in_the_folder_UCSC(folder)

###
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

### 4 ######
folder = "/zp1/data/plyu3/UCSC_old/pmid35093191"
TAG = "35093191_Human_Brain"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

###
### 5 ######
###
folder = "/zp1/data/plyu3/UCSC_old/pmid35165441"
TAG = "35165441_Human_Brain"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



###
### OK!!! next is the SCP datasets !!! ########
###


###
### this is not on the UCSC_old folder !!! #####
###

to = "/zp1/data/plyu3/CellAnn_batch8/"



#### batch 1 ###

folder = "/zp1/data/plyu3/SCP_old/pmid28428369"
TAG = "28428369_Human_Blood"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### batch 2 ###
mkdir pmid30382198ALM
mv  pmid30382198ALM_seurat_obj pmid30382198ALM/pmid30382198ALM_seurat_obj

folder = "/zp1/data/plyu3/SCP_old/pmid30382198ALM"
TAG = "30382198_Mouse_Brain"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### batch 3 ###
mkdir /zp1/data/plyu3/SCP_old/pmid30382198LGd
mv  pmid30382198LGd_seurat_obj pmid30382198LGd/pmid30382198LGd_seurat_obj

folder = "/zp1/data/plyu3/SCP_old/pmid30382198LGd"
TAG = "30382198_Mouse_Brain_LGd"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### batch 4 ###
mkdir /zp1/data/plyu3/SCP_old/pmid32413319
mv  pmid32413319_seurat_obj pmid32413319/pmid32413319_seurat_obj

folder = "/zp1/data/plyu3/SCP_old/pmid32413319"
TAG = "32413319_Human_Airway"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


####
#### batch5 #####
#### pmid32427356_seurat_obj

mkdir "/zp1/data/plyu3/SCP_old/pmid32427356"
mv pmid32427356_seurat_obj pmid32427356/pmid32427356_seurat_obj

folder = "/zp1/data/plyu3/SCP_old/pmid32427356"
TAG = "32427356_Mouse_Bone"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### batch6 #####
#### pmid32555229
mkdir /zp1/data/plyu3/SCP_old/pmid32555229_AC
mkdir /zp1/data/plyu3/SCP_old/pmid32555229_BP
mkdir /zp1/data/plyu3/SCP_old/pmid32555229_HC
mkdir /zp1/data/plyu3/SCP_old/pmid32555229_NN
mkdir /zp1/data/plyu3/SCP_old/pmid32555229_PR
mkdir /zp1/data/plyu3/SCP_old/pmid32555229_RGC

cd /zp1/data/plyu3/SCP_old/pmid32555229

folder = "/zp1/data/plyu3/SCP_old/pmid32555229_AC"
TAG = "32555229_Human_eye_AC"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### batch 1 ####
folder = "/zp1/data/plyu3/SCP_old/pmid32555229_BP"
TAG = "32555229_Human_eye_BP"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### batch 2 ####
folder = "/zp1/data/plyu3/SCP_old/pmid32555229_HC"
TAG = "32555229_Human_eye_HC"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### batch 3 ####
folder = "/zp1/data/plyu3/SCP_old/pmid32555229_NN"
TAG = "32555229_Human_eye_NN"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### batch 4 ####
folder = "/zp1/data/plyu3/SCP_old/pmid32555229_PR"
TAG = "32555229_Human_eye_PR"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### batch 5 ####
folder = "/zp1/data/plyu3/SCP_old/pmid32555229_RGC"
TAG = "32555229_Human_eye_RGC"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### batch6 ######

mkdir "/zp1/data/plyu3/SCP_old/pmid32994417"
mv pmid32994417_seurat_obj pmid32994417/pmid32994417_seurat_obj

folder = "/zp1/data/plyu3/SCP_old/pmid32994417"
TAG = "32994417_Mouse_Brain"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


### batch7 ####

mkdir "/zp1/data/plyu3/SCP_old/pmid33444290"
mv pmid33444290_seurat_obj pmid33444290/pmid33444290_seurat_obj

folder = "/zp1/data/plyu3/SCP_old/pmid33444290"
TAG = "32994417_Mouse_Kidney"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


### batch1 #####
folder = "/zp1/data/plyu3/SCP_old/pmid33655247Heart"
TAG = "33655247_Human_Heart"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


### batch2 #####
folder = "/zp1/data/plyu3/SCP_old/pmid33655247Kidney"
TAG = "33655247_Human_Kidney"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log2")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


### batch3 #####
folder = "/zp1/data/plyu3/SCP_old/pmid33655247Liver"
TAG = "33655247_Human_Liver"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

### batch4 #####
folder = "/zp1/data/plyu3/SCP_old/pmid33655247Lung"
TAG = "33655247_Human_Lung"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

### batch5 #####
folder = "/zp1/data/plyu3/SCP_old/pmid34616064adult"
TAG = "34616064_Mouse_brain_adult"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


### batch6 #####
folder = "/zp1/data/plyu3/SCP_old/pmid34616064dev"
TAG = "34616064_Mouse_brain_dev"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

### batch2 #####
mkdir "/zp1/data/plyu3/SCP_old/pmid34642245"
mv pmid34642245_seurat_obj pmid34642245/pmid34642245_seurat_obj

folder = "/zp1/data/plyu3/SCP_old/pmid34642245"
TAG = "34642245_Mouse_Blood"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### batch3 #####
folder = "/zp1/data/plyu3/SCP_old/pmid35241836"
TAG = "35241836_Human_Pancreas"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#### batch6 #####
folder = "/zp1/data/plyu3/SCP_old/pmid35296864Hs"
TAG = "35296864_Human_Adipose"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


#### batch1 #####
folder = "/zp1/data/plyu3/SCP_old/pmid35296864Mm"
TAG = "35296864_Mouse_Adipose"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="log")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)




###
### blue download mouse eye datasets #######
###

scp -r /zp1/data/yzhai11/SCPData plyu3@omb2.onc.jhmi.edu:/zp1/data/plyu3/SCP_old

### Next we download a new retina datasets ####
mkdir /zp1/data/plyu3/Eye_add_CellAnn
Single cell RNA-Seq atlas of the developing murine retina
PMID: 31128945
mkdir /zp1/data/plyu3/Eye_add_CellAnn/31128945_Mouse_dev_retina


### ##### ###
### OK!!! ###
### ##### ###




###
###
### batch7 #####
###
folder = "/zp1/data/plyu3/Eye_add_CellAnn/31128945_Mouse_dev_retina"
setwd(folder)
files = list.files()
mat = Matrix::readMM("10x_mouse_retina_development.mtx")
cols = read.table(files[3],header=T,sep=',')
genes = read.table(files[1],header=T,sep=',')

rownames(mat) = genes$gene_short_name
colnames(mat) = cols$barcode

cluster = cols[,c(2,94,9,10,11)]
colnames(cluster) = c()

colnames(cluster) <- c('cell','celltype','dim1','dim2','dim3')
Broad_create_seurat_obj(mat,cluster,file="31128945_Mouse_dev_retina_seurat_obj")
##### 

TAG = "31128945_Mouse_dev_retina"

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



#####
##### Then next paper !!! ######
#####
#####
##### Jie's science paper !!! #######
#####
Gene regulatory networks controlling vertebrate retinal regeneration

PMID: 33004674
mkdir /zp1/data/plyu3/Eye_add_CellAnn/33004674_Mouse_injury_retina

##### 
##### prepare !!! #######
#####

##### batch7 ############
#####
folder = "/zp1/data/plyu3/Eye_add_CellAnn/33004674_Mouse_injury_retina"
setwd(folder)
load('Mouse_LD_pbmc_seurat.RData')

#####
Mouse_LD_pbmc_seurat <- UpdateSeuratObject(pbmc)

matrix_input = Mouse_LD_pbmc_seurat[['RNA']]@counts

#####
cluster = read.table('Mouse_LD_cell_features.tsv',header=F,sep='\t')
cluster = cluster[,c(1,3,4,5)]
colnames(cluster) <- c('cell','celltype','dim1','dim2')

##### replace with gene symbol #####
#####
gene = read.table('Mouse_gene_features.tsv',sep='\t')

m = match(rownames(matrix_input),gene$V1)
rownames(matrix_input) = gene$V2[m]

TAG = "33004674_Mouse_injury_retina"

Broad_create_seurat_obj(matrix_input,cluster,file="33004674_Mouse_injury_retina_seurat_obj")
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#######
####### OK!!! Next retina reference !! #########
#######

Cell-Type-Specific Complement Expression in the
Healthy and Diseased Retina

GSE116426


#######
Phase transition specified by a binary code patterns the vertebrate eye cup


#######
Single-cell transcriptomics of the human retinal pigment epithelium and choroid in health and macular degeneration





#######
The Tabula Sapiens: A multiple-organ, single-cell transcriptomic atlas of humans
#######
####### CellXGene website ########
#######
mkdir /zp1/data/plyu3/Altas_add_CellAnn
mkdir /zp1/data/plyu3/Altas_add_CellAnn/Tabula_Sapiens_combine

cd /zp1/data/plyu3/Altas_add_CellAnn/Tabula_Sapiens_combine

nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/fab1d235-d9fe-4028-81db-029983860486/local.rds?AWSAccessKeyId=ASIATLYQ5N5XTF2IWXFA&Signature=7CYOdect5EzJmO3qvwlST2yYado%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEFAaCXVzLXdlc3QtMiJHMEUCIQCHc%2ByB9tr%2Bk%2FzGGcqdvBzCWmn6Vpw%2BLzvvoBa%2FYARL9wIgSk5bw3Ag1pxHkWlUdYTiWemnKb02QbAnvwxBdS5QaWsq9AMIyf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARABGgwyMzE0MjY4NDY1NzUiDAIPGlX2F2Aw%2BSABIirIA8o3LqwUbKtFvYuZTk8QFl1r52JelIeKpyXncTgFrClTrH%2FFIL07t2xUq4%2FnlSBQ9swk0SGQP%2BWajjagebV%2Ba3MLbIweiF0frL8mtbfDro%2BFHbPXxnxvll%2Fu7xBgTt3uOwW1NmRe13hZJyttJFC%2FuXSiSyU0kvmW2RpoMWfaj4GV5pUbF%2FAAYNM2FWAsZNBQniv82S4un3DVdNkCzCcoFSFNRFqq8hZQOfS9GxGMQwOc%2B1%2F%2FkxGddmTIJDpGox%2FL8j5c9SkJTFFaUSfflLSM29RSUrAAPtt3aMnoH6ZGmoHIN4DcU5Yqhbf4mSQ1Wjldxdnzr8%2Fs64M9C8P2nzy7GR5l2QDEcTQFLWFm4xaQCC2xOJ6EfbgdlpQWUuVLhneoj6UhJtxOXT71lchc9%2FRQafdYLlBvGdDwznnfBp7Sj4ctADYSS3PwLUxdXYA6cpEbxQh3MRWR0TckO1foNOgJO8DAdyBuiMVVNRnQgnFqnQOUVzrUCGtC%2FPjt1ipOmLnJeOjOdU%2BrrkoS2B5r8fvZBjoBK1jbtGL7JicCMwqwtGXD0XVL5CxOyi1N6Ianob7K5l0sVw9k8S%2ForfxJ7HHqysUxtZUniAcdljDG6uueBjqlAVcFDw2P%2F50COUtAly%2BX0sQ%2B7xX34Dr4zuB773IvPfmpSrFNtQ1%2BrGQW09t4xBcg4zWlGNnX18uyMbUZjwlUDen2PeRVRP8NzXaDYdrOhGqnuoaUDxwmqHoOAHG3TQpUG3%2FsPkAsywoEHFKKdkkzwAryJoruI13DL0MPcM38nuba4MMzPq1EUrNuALiY4G1TYjh6xsXfOt%2B9CNFE4VHeUJOI2mALjw%3D%3D&Expires=1675898913" &


####### OK!!! next altas !!! ######
#######

A human cell atlas of fetal gene expression

####### CellXGene website ##########

mkdir /zp1/data/plyu3/Altas_add_CellAnn/Human_atlas_fetal

nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/eaa5ade6-3207-4bbb-bfb8-025f2f917068/local.rds?AWSAccessKeyId=ASIATLYQ5N5X5C4BVZ42&Signature=xwjWG493gK505ALGRJSafU5UmAg%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEFAaCXVzLXdlc3QtMiJHMEUCIAqUVzEPmniayMa69M5LSnZZWWYmWlUpIuJsem4epIQtAiEAkhehJ9sIohd1rChk2FADtI7PrAybFHS2tZdGzgHt4Z0q9AMIyf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARABGgwyMzE0MjY4NDY1NzUiDOodgVcp6c5Jt9m4VCrIA966Gx4Dd%2Fmebcuenh1JoMbG9sB75uQ28wmoJqfUhc5lQqPEUGrDSNqiaE6O9vuMdzJa6behkijPQI07FgxRzg8w4ZhUfxPUsalOSClcnHW0ql8WGWdoEFn1ML%2FYYqBbvGs68YU9vZ5UcQ7A3VMSqWXIhjSGO1FbBSvNqbADah2%2BGu03zk0PU1AEOCGepQQl81TmSQavHeB0rO9M3TD5LitUfD7Ppk1c54eErXl5cR3klxOGxSdgfCs69fTsKo4g%2BADz%2BxyBZLHSg9VP9vPFED%2FmrRAyCq9kFpPEDZ5ksZ6M2ISGGQT3DDLLSp0arNR4RD6he8NtguorccAOmu%2BLXimZpfVhp4Z2j3JAFtw8%2BX0ZWEPagEBLByP7mclv7z8n5Wt91wLq685BM%2BBdVIWGOOqat18Jlt8T0L4Dy4da0H1bzHPE28tCOJzBvT7JkuVGEmp6hEFG9fLo1pCDHOsI7y3mpsUmq6wMMdVrXH6JGn760XnXs7Rldlz3z0nL5ek3ZaMb9WXUoEBf4tc2%2FaQdDxPnxzO%2BJtVK7egQ7NNsnW03lxAcQnWtF0zxFlsQXDLqLlzqxjIlpob5wV8GmIyvGDZWbx4Heq4wwzDH6uueBjqlAbgBhEz3U51rIsL56oDTZ52psKNdK8MubOdTHb%2BWzdkTqRXqRB6AKMFCDPwYy6PF1o8rLbA8z%2FvfdtUli2ybnVac7xkKugxygYjxzdmdqPBMqosxpAhC6MsveM%2BdokybrzHmiO%2FZLweIOyU%2FL%2BUqUyAezO%2FUiiHzRGNk3tn4lLeRGtOKs6PQH1PaxcK4vioDvMu4XCctYZhFGgCaL0AdseJ6GbHn%2FA%3D%3D&Expires=1675900196" &

####### Next !!! ##################

Construction of a human cell landscape at single-cell level

####### Next !!! ##################

mkdir /zp1/data/plyu3/Altas_add_CellAnn/Human_cell_landscape

nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/29308ce0-745f-486b-976b-1e58f612a91f/local.rds?AWSAccessKeyId=ASIATLYQ5N5XXMQ6XW2Q&Signature=szWcy%2F8fjioBuXkfwQoeedEoG%2FE%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEEsaCXVzLXdlc3QtMiJGMEQCIE%2FqjGTtvaaPjL9PkiWtk%2FFN97YVBOmM6Dst5He4kCf4AiBZgakARMyvJnHQcoEbfnfrTnQe%2B1fkKtngtBXOsaWHACr0AwjE%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAEaDDIzMTQyNjg0NjU3NSIMwgT2MPXDACHbGtekKsgDENvyJh46atCnJuYMUz%2B7nYG8ByF6T%2FwNLoyYhgxLhlydoHXwXOB2pSzUmnOWxxET0fELWSr%2FXqo9Xs7Iqpyu%2F%2BqW2MtntacZbJz7adZkRLc1VLO4m9fPb2ehyyonQP3kDXZ%2Bo2%2BLsRrRgnfNV5scD6oqcUimcq%2FeyULRpyar5B6o%2B2kLT4PTpEbHKIcO1AmhFpLAXbALwzCf50KSdgdthUJgW4Cri5haEynNleufp%2Bp%2B6%2FMwJd3pb0fpqTw12gKi0qFv68PUryZI98Vky6uVXu01Vj4FUwi1AK9cA5iKJXT1zczt9XafILMarDpshaSNS1eJ9DAxh1z230IFUtFM6JEJGoD5grfXmBFMwldhErdbzXZTxlVHfAL6%2BRP3TauWWQ1n2Wk%2BUgqOe81mDQ7tloFzioR2zrW5jyEHZwSIT5X4IwN8eToF8OKWw1miEkeM2xLNJ5P0Vp8%2B6rPUDetcX5bsjsWiu1ZUv870Fs14Ys8H6zxPGKQeb4gTmSpZ%2BCHuMqGRAMMeEFVN32XlG%2BmRI%2BOB6Mo4lQEAwuOLfXYZgMjht6wT%2Bmwaf5AaA%2Ba%2F1%2FR0nbf1qZ275jmwf1aG%2FY%2B7gxMw4HmD8j8tMJLp6p4GOqYB7r9fD12pwaQiRlEiO3P%2F7TRHqyoKuE1iigNLOkbDd9Mdbl9BELecGQlWABSFG%2BqeNTaZvO0cYVjKdGBlNdLHak6vpcm%2FuOtUgcJnbOnpNZNNnKK5bbXOVdYFliQ1P21CJNiSbETHj21xDgLECTyDNstYxTnsVxzBZxReZbGoOa2nC5KYkDmD2tJg7KVk%2BnkMvgF4AFHjUiz4wHjH3kShUiTZwfE%2BiQ%3D%3D&Expires=1675900362" &


####### Next !!! ###################
MSK SPECTRUM – Ovarian cancer mutational processes drive site-specific immune evasion

mkdir /zp1/data/plyu3/Altas_add_CellAnn/Ovarian_cancer

nohup curl -o local.h5ad "https://corpora-data-prod.s3.amazonaws.com/b252b015-b488-4d5c-b16e-968c13e48a2c/local.h5ad?AWSAccessKeyId=ASIATLYQ5N5XXMQ6XW2Q&Signature=OCQJdJozuXyipgWU5GsCJT9DyYg%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEEsaCXVzLXdlc3QtMiJGMEQCIE%2FqjGTtvaaPjL9PkiWtk%2FFN97YVBOmM6Dst5He4kCf4AiBZgakARMyvJnHQcoEbfnfrTnQe%2B1fkKtngtBXOsaWHACr0AwjE%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAEaDDIzMTQyNjg0NjU3NSIMwgT2MPXDACHbGtekKsgDENvyJh46atCnJuYMUz%2B7nYG8ByF6T%2FwNLoyYhgxLhlydoHXwXOB2pSzUmnOWxxET0fELWSr%2FXqo9Xs7Iqpyu%2F%2BqW2MtntacZbJz7adZkRLc1VLO4m9fPb2ehyyonQP3kDXZ%2Bo2%2BLsRrRgnfNV5scD6oqcUimcq%2FeyULRpyar5B6o%2B2kLT4PTpEbHKIcO1AmhFpLAXbALwzCf50KSdgdthUJgW4Cri5haEynNleufp%2Bp%2B6%2FMwJd3pb0fpqTw12gKi0qFv68PUryZI98Vky6uVXu01Vj4FUwi1AK9cA5iKJXT1zczt9XafILMarDpshaSNS1eJ9DAxh1z230IFUtFM6JEJGoD5grfXmBFMwldhErdbzXZTxlVHfAL6%2BRP3TauWWQ1n2Wk%2BUgqOe81mDQ7tloFzioR2zrW5jyEHZwSIT5X4IwN8eToF8OKWw1miEkeM2xLNJ5P0Vp8%2B6rPUDetcX5bsjsWiu1ZUv870Fs14Ys8H6zxPGKQeb4gTmSpZ%2BCHuMqGRAMMeEFVN32XlG%2BmRI%2BOB6Mo4lQEAwuOLfXYZgMjht6wT%2Bmwaf5AaA%2Ba%2F1%2FR0nbf1qZ275jmwf1aG%2FY%2B7gxMw4HmD8j8tMJLp6p4GOqYB7r9fD12pwaQiRlEiO3P%2F7TRHqyoKuE1iigNLOkbDd9Mdbl9BELecGQlWABSFG%2BqeNTaZvO0cYVjKdGBlNdLHak6vpcm%2FuOtUgcJnbOnpNZNNnKK5bbXOVdYFliQ1P21CJNiSbETHj21xDgLECTyDNstYxTnsVxzBZxReZbGoOa2nC5KYkDmD2tJg7KVk%2BnkMvgF4AFHjUiz4wHjH3kShUiTZwfE%2BiQ%3D%3D&Expires=1675901470" &

####### Next !!! ###################

Mapping the developing human immune system across organs

mkdir /zp1/data/plyu3/Altas_add_CellAnn/developing_human_immune_system

cd /zp1/data/plyu3/Altas_add_CellAnn/developing_human_immune_system

nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/593125fb-7794-4a87-82db-2bb166072611/local.rds?AWSAccessKeyId=ASIATLYQ5N5XXMQ6XW2Q&Signature=JE6l%2F8xLDW1s9OFXYKJkJcqQo74%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEEsaCXVzLXdlc3QtMiJGMEQCIE%2FqjGTtvaaPjL9PkiWtk%2FFN97YVBOmM6Dst5He4kCf4AiBZgakARMyvJnHQcoEbfnfrTnQe%2B1fkKtngtBXOsaWHACr0AwjE%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAEaDDIzMTQyNjg0NjU3NSIMwgT2MPXDACHbGtekKsgDENvyJh46atCnJuYMUz%2B7nYG8ByF6T%2FwNLoyYhgxLhlydoHXwXOB2pSzUmnOWxxET0fELWSr%2FXqo9Xs7Iqpyu%2F%2BqW2MtntacZbJz7adZkRLc1VLO4m9fPb2ehyyonQP3kDXZ%2Bo2%2BLsRrRgnfNV5scD6oqcUimcq%2FeyULRpyar5B6o%2B2kLT4PTpEbHKIcO1AmhFpLAXbALwzCf50KSdgdthUJgW4Cri5haEynNleufp%2Bp%2B6%2FMwJd3pb0fpqTw12gKi0qFv68PUryZI98Vky6uVXu01Vj4FUwi1AK9cA5iKJXT1zczt9XafILMarDpshaSNS1eJ9DAxh1z230IFUtFM6JEJGoD5grfXmBFMwldhErdbzXZTxlVHfAL6%2BRP3TauWWQ1n2Wk%2BUgqOe81mDQ7tloFzioR2zrW5jyEHZwSIT5X4IwN8eToF8OKWw1miEkeM2xLNJ5P0Vp8%2B6rPUDetcX5bsjsWiu1ZUv870Fs14Ys8H6zxPGKQeb4gTmSpZ%2BCHuMqGRAMMeEFVN32XlG%2BmRI%2BOB6Mo4lQEAwuOLfXYZgMjht6wT%2Bmwaf5AaA%2Ba%2F1%2FR0nbf1qZ275jmwf1aG%2FY%2B7gxMw4HmD8j8tMJLp6p4GOqYB7r9fD12pwaQiRlEiO3P%2F7TRHqyoKuE1iigNLOkbDd9Mdbl9BELecGQlWABSFG%2BqeNTaZvO0cYVjKdGBlNdLHak6vpcm%2FuOtUgcJnbOnpNZNNnKK5bbXOVdYFliQ1P21CJNiSbETHj21xDgLECTyDNstYxTnsVxzBZxReZbGoOa2nC5KYkDmD2tJg7KVk%2BnkMvgF4AFHjUiz4wHjH3kShUiTZwfE%2BiQ%3D%3D&Expires=1675901940" &


setwd('/zp1/data/plyu3/Altas_add_CellAnn/developing_human_immune_system')
seurat <- readRDS('local.rds')


####### 









####### Next !!! ##################

Tabula Muris Senis

mkdir /zp1/data/plyu3/Altas_add_CellAnn/Tabula_Muris_Senis_10X

cd /zp1/data/plyu3/Altas_add_CellAnn/Tabula_Muris_Senis_10X

nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/d9e56525-f4f4-4f6b-a7a7-2b7d158f282b/local.rds?AWSAccessKeyId=ASIATLYQ5N5XUSUXQLXK&Signature=qzCfnSj7o301eEEy%2BEqSZFHoPuo%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEFAaCXVzLXdlc3QtMiJGMEQCIE8iqLLTGfeH%2FBD2xw81I2uIczT%2FTLNO%2Fm3uIhHsyeqtAiBHL88mYV8U3IQPwiRaGV8OJO8bg2P6BVvrItlsZSM5sir0AwjJ%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAEaDDIzMTQyNjg0NjU3NSIMmYDqma5sMsWLcQ21KsgDWHWYlM27dhaxboMo%2BV7YBVaflWuGZaBocnWgGt1KILnlxqhEqllTWgjXZCiQ3pt87%2FCpokaEsZM09i4fiEv6hI7hU7Ec1y7%2FsPRBQ3RbTFCCg2kRESjEb4wJ5Yf9wfc2hnq8GxDhdtfTkXvgyFqDAPQKQ27%2BxR2JTyltdZ%2FyT%2FXxywXSEjCqT%2BVr6drXGv3dEoiqMrdsEAW46PyO%2Bmhwxvc96YHGm2%2BDHWtxTRqvilcLcWXfJXmkYuTmfd3aOS7%2FUAdrLZn8GKzo3FryNSne0mIXbf%2Bn2qWN8pYMFoWFzeppmO11aU%2FZ%2Fe4D%2BoC5su3swxYddh1LOp0HIGveXZQ5jeEKbG4EiHRKHYx%2FARCadZDPNNwDN9B9pcxySpf0hTbvlFOomPn%2BbnCpbl53Cx9SdhjtJA0b4EZ5UP2pPyuyNONXL5Hk8jz4Xh4%2BiN9AAeZWnlaEYFQSs4QiySDUdhVlWfLCyyfmKxGYtr5jJ7ORC8dAfF4L1c9Waf7Gxg8fmATZqUpfE65u%2BlZ66flctirufL0peOyvp8Zr%2FHFonblrKRLkWpYOjntcLHEBkS996j9F3z7qqjPigTmnESHC2NWZ%2FnQIyzerqhksMLn%2F654GOqYBO0OX2DEhiNr8S7lLZP%2FRBfOGsm%2B%2Bi%2BIfycpoQ9FNa%2FbO19djmzDaRAq7vum1V04lFXvmmIDfHNqmHamsAKC7fEGM8ya40IJ1bAevlStd5L8muezJNuV%2BzxSwBuOTXyz03wwhHlfINZP7WSUId6zQpCoEJaPVP1bOerQy5XFrZIQryEXwl2aP%2Fg%2B3po%2Bq9dIRUWHwvYsx4JHpFHvHz4aej6QCilWhlQ%3D%3D&Expires=1675902148" &

####### OK!!! then we split the seurat objects !!! ########
#######
setwd("/zp1/data/plyu3/Altas_add_CellAnn/Tabula_Muris_Senis_10X")

list.files()
test1 <- readRDS("pmid32669714_Tabula_Muris_10X_thymus_avg_mat")
test2 <- readRDS("pmid32669714_Tabula_Muris_10X_tongue_avg_mat")

seurat <- readRDS('local.rds')

library(Seurat)

seurat_split_obj <- SplitObject(seurat, split.by = "tissue")

for(i in 1:length(seurat_split_obj)){
	tag = names(seurat_split_obj)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	####
	tmp_seurat = seurat_split_obj[[i]]
	####
	file = paste0(tag,'_seurat_obj')
	####
	saveRDS(tmp_seurat,file=file)
}

########## #################

for(i in 1:length(seurat_split_obj)){
	tag = names(seurat_split_obj)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	######
	folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/Tabula_Muris_Senis_10X/",tag,'10X')
	######
	TAG = "32669714_Tabula_Muris_10X"
	TAG = paste0(TAG,'_',tag)
	####
	to = "/zp1/data/plyu3/Altas_add_CellAnn/Tabula_Muris_Senis_10X/"
	####
	Read_Seurat_file_in_the_folder_UCSC(folder)
	Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)
}



####### 
mkdir /zp1/data/plyu3/Altas_add_CellAnn/Tabula_Muris_Senis_Smartseq2

cd /zp1/data/plyu3/Altas_add_CellAnn/Tabula_Muris_Senis_Smartseq2

nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/135b3e74-71b8-4c26-9e6b-2e6ec59d2306/local.rds?AWSAccessKeyId=ASIATLYQ5N5XYJYKESPS&Signature=DXD90cU9QRgLsXhHS5bJREjQnA0%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEFAaCXVzLXdlc3QtMiJHMEUCIQCiQ6EFwqHUq%2BxUnXSkxX1nniqdWjKnKwWuWQKHDBL63AIgAa2qsqqaYG2FvlBIFv4EnvvtyNUJH6dqgKdRPTScHXQq9AMIyf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARABGgwyMzE0MjY4NDY1NzUiDBRG0Mo1KlZFgGWZoSrIA5pgy4PcdF8oyYg4ZQw%2FQrvTQyUJOqcISLsyc%2BqLFEsUp1PZ%2FL07qW%2FEy471PCSdhQV90d0PSHtEJx9Lfyzu2ogAmVQ7ssaBmdVqY%2BKxrU3t2ET5ARSOETmsNYjRZA%2FNBWm2RUX5t6%2FYtl93pllbY209Xrn6EdX3vpOtUMfNd7HCT%2BeaWsWQYWAO8fog6JGPQ%2FWvptRSqfwSv9yxrI6uSx%2FXCyAu4AvLWPLlCCBO84PGAu4i7C1oNbaf2oAODtnr2kYYDLbwFo%2Br1DZWKBulqKFiDpU8pVVdTcmW1QyLEX9EJeHkgGJ8YneHOYRlkmsjMsZT5hnTyEFaqmIudLUHiJa%2F%2BSNwxwc9aDdMQIL11CQbwrE8YTpHJV0BE6DFiYsD7IpRSPRD4YuUeuVFpWcJr84fWnre7EvqOFTBDK7CpLDq8p4%2BoLMEfgy5kCfLYDNl1LMoXP%2Bt3qrAgz1jTE2a68dWWC%2FvXB7JwqrJfabWQdMoWuq1R7BQGlgpu22cYFqGnJtsErCKwYbLBqIYEDPoLMdcqZZ8uSnofUefSnJ0ckWcuUjgr9maHc%2ByptSGg%2BNeT8JhespAHrD0ouEGzSDfiEdd%2FFny5AVxmDC%2B%2FOueBjqlAbSflGX5UYIAU5sxaNB7afe31wnvs9gQ81UnS6xcJB5PQOvZZysYuOYBr%2FT8xr8cZ5QEJriIysIrKpCtSwq5bJR18XXXq8GdAvnf0Vn2rsarR6f4avBoNALfSRyKLY2mYBMufVPS4BSm5KIDp3IKymevbVsvTn0JMJ05i7xHVc%2BCwzRJwIoSydceLhxIysVk0LkfYcbJzxT%2BptzfdzPGQBkfWyzmVA%3D%3D&Expires=1675902271" &

########

setwd('/zp1/data/plyu3/Altas_add_CellAnn/Tabula_Muris_Senis_Smartseq2')
seurat <- readRDS('local.rds')

#######
#######
library('rtracklayer')

file = '/zp1/data/plyu3/Human_scATACseq_new/scATAC/Human_annotation/gencode.v38.basic.annotation.nochr.gtf'
gtf <- rtracklayer::import(file)
gtf_df <- as.data.frame(gtf)




gtf = rtracklayer::import('/zp1/data/plyu3/mouse_aging_res/gencode.vM10.basic.annotation.gtf.gz')
head(gtf)
gtf = data.frame(gtf)
gtf = gtf[which(gtf$type == 'gene'),]
gtf = gtf[which(gtf$gene_type == 'protein_coding'),]

gtf = gtf[,c(10,12)]

gtf$id = sapply(strsplit(as.character(gtf$gene_id),split='.',fixed=T),function(x) x[[1]])

saveRDS(gtf,file='/zp1/data/plyu3/Altas_add_CellAnn/Human_gene_convert')

saveRDS(gtf,file='/zp1/data/plyu3/Altas_add_CellAnn/Mouse_gene_convert')

gtf <- readRDS('/zp1/data/plyu3/Altas_add_CellAnn/Mouse_gene_convert')
########
seurat_split_obj <- SplitObject(seurat, split.by = "tissue")

for(i in 1:length(seurat_split_obj)){
	tag = names(seurat_split_obj)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	####
	tmp_seurat = seurat_split_obj[[i]]
	####
	mat = tmp_seurat[['RNA']]@counts
	####
	m = match(rownames(mat),gtf$id)
	rownames(mat) = gtf$gene_name[m]
	k = which(is.na(rownames(mat)) == T)
	if(length(k) > 0){
		mat = mat[-k,]
	}
	####
	tmp_seurat2 = CreateSeuratObject(mat)
	tmp_seurat2@meta.data = tmp_seurat@meta.data
	tmp_seurat2$celltype = tmp_seurat2$cell_type
	####
	folder = paste0(tag,'10X')
	command = paste('mkdir',folder)
	system(command)
	####
	file = paste0(tag,'10X','/',tag,'_seurat_obj')
	####
	saveRDS(tmp_seurat2,file=file)
}

library(Seurat)

for(i in 1:length(seurat_split_obj)){
	tag = names(seurat_split_obj)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	######
	folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/Tabula_Muris_Senis_Smartseq2/",tag,'Smartseq2')
	######
	TAG = "32669714_Tabula_Muris_Smartseq2"
	TAG = paste0(TAG,'_',tag)
	####
	to = "/zp1/data/plyu3/Altas_add_CellAnn/Tabula_Muris_Senis_Smartseq2/"
	####
	Read_Seurat_file_in_the_folder_UCSC(folder)
	Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)
}



########
########
######## the last one !!!! ###########
########
########

Cross-tissue immune cell analysis reveals tissue-specific features in humans

mkdir /zp1/data/plyu3/Altas_add_CellAnn/Cross_tissue_immune_cell

cd /zp1/data/plyu3/Altas_add_CellAnn/Cross_tissue_immune_cell

nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/229f8667-7318-4b5b-b6f2-c4cdae630130/local.rds?AWSAccessKeyId=ASIATLYQ5N5X6FZVAN7L&Signature=j3%2BRHAIQUO%2BvEZR07MRPgWDtTI4%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEFAaCXVzLXdlc3QtMiJIMEYCIQDq3QHMRb8bxkNUulMZ9x%2BiqISJ2wL7vOJCBlivJPGVxgIhALkXjcfeyL74inEyI%2F7%2FTq0q6s3QU6hEwTegCNIV6HxmKvQDCMn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQARoMMjMxNDI2ODQ2NTc1IgzqZPcL2MQmiqfUHq8qyAO7VtDAGjLnC%2FFte74UiZTSPT2JASA5N%2FP86sANy3NKqWjcaCskPs8afQbXjR0s4tz2odfv8eERedm4NnU%2FXr5Cs%2BrEoR2eQNi%2BGDa83PACJecgkDWM03O0Hive3Gx9T%2BZUnJEwLu3uLZxUNzBARkB9J8Vu26ZrSIQmG%2BjqoWjH8b%2BJJVIEQCua%2FaCTzIbdsFYVxlaiRK83ZdM0a%2BR%2BUcBV3pTjfYsb8oTB5HCW4tztKqPXDnI1tyXU8zGM40cvgmai12rweqvF3V%2FkU1SFabaSFjYksGiEZvvwbUBR%2FR3MYgKZvfguc0gHU%2FKxQlNOWEE11OZ7KM%2FIG9YnlOvW8qIT6hTPFhdkg5XCZ%2BIrzQ0cQB887lPIbjPJlez6hhlN6PTSS6cn%2FUi3djWv5%2BDbUVYubuGR3DFfqvaLfA%2B8d%2ByfJ9iNTIJXBYrocfmeBIE8pLWkmJTiukn2ZRo51PBp0HJ4esGiZpAgxbHzzDjrFkXyeAUjQzhNGBiT%2FnkB60BACihHMsHy3IGZmVbTbeG3YySMC3DyrBmBrpm%2BMY%2BshqD%2BigvDsOmO8anLUFXP%2BrKYzil3nuxBVLtfPL8OPKkhgYpDKP9p%2FHWtOk0wjvzrngY6pAH1AStw1kw7ciigqMdupoHhjf5PyFSJRgdXiTbA%2BxMN9Sfe4dVZ7D9HJCTiEdMyylHkt1ut0XcmwDoyi7UmOzgpDk96JAOrcmCv0Y6V%2FXWYOyri015pv3maU8CTIboA6GSPd%2FTzPCl3cIJnQcSxbzbOJWWOL1Hdj6wflcCWQHXuyiBGe9y9PAzJW7i6blMMd4zr1LbaHzKbFQo5ZUGiDrO7ToKrUw%3D%3D&Expires=1675902738" &

setwd('/zp1/data/plyu3/Altas_add_CellAnn/Cross_tissue_immune_cell')
seurat <- readRDS('local.rds')

########
seurat_split_obj <- SplitObject(seurat, split.by = "tissue")
########
########

for(i in 1:length(seurat_split_obj)){
	tag = names(seurat_split_obj)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	####
	tmp_seurat = seurat_split_obj[[i]]
	####
	file = paste0(tag,'_seurat_obj')
	####
	saveRDS(tmp_seurat,file=file)
}

########
########

load('/zp1/data/plyu3/Altas_add_CellAnn/Human_gene_convert')

######## test the first matrix ########
########

t <- readRDS("pmid35549406_Cross_tissue_immune_thoracic_lymph_node_avg_mat")


for(i in 1:length(seurat_split_obj)){
	tag = names(seurat_split_obj)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	####
	tmp_seurat = seurat_split_obj[[i]]
	####
	mat = tmp_seurat[['RNA']]@counts
	####
	m = match(rownames(mat),gtf$id)
	rownames(mat) = gtf$gene_name[m]
	k = which(is.na(rownames(mat)) == T)
	if(length(k) > 0){
		mat = mat[-k,]
	}
	####
	tmp_seurat2 = CreateSeuratObject(mat)
	tmp_seurat2@meta.data = tmp_seurat@meta.data
	tmp_seurat2$celltype = tmp_seurat2$cell_type
	####
	folder = paste0(tag,'Cross_tissue_immune')
	command = paste('mkdir',folder)
	system(command)
	####
	file = paste0(tag,'Cross_tissue_immune','/',tag,'_seurat_obj')
	####
	saveRDS(tmp_seurat2,file=file)
}

###### 
###### ##### ######
###### 
######

for(i in 1:length(seurat_split_obj)){
	tag = names(seurat_split_obj)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	######
	folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/Cross_tissue_immune_cell/",tag,'Cross_tissue_immune')
	######
	TAG = "35549406_Cross_tissue_immune"
	TAG = paste0(TAG,'_',tag)
	####
	to = "/zp1/data/plyu3/Altas_add_CellAnn/Cross_tissue_immune_cell/"
	####
	Read_Seurat_file_in_the_folder_UCSC(folder)
	Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)
}








#####
##### human pancreas datasets #############
#####

setwd('/zp1/data/plyu3/CellAnn_test_AUC/Human_pancreas_prepare')
saveRDS(Enge_pancreas_seurat_human,file='Enge_pancreas_seurat_human')

##### ######
##### ######
##### ######

ssh plyu3@10.112.40.197
njd$rft1

mkdir Baron_pancreas_seurat_human_F
mv Baron_pancreas_seurat_human Baron_pancreas_seurat_human_F/Baron_pancreas_seurat_human_seurat_obj
scp -r Baron_pancreas_seurat_human_F plyu3@omb2.onc.jhmi.edu:/zp1/data/plyu3/cellann_add_paper/
mkdir Enge_pancreas_seurat_human_F
mv Enge_pancreas_seurat_human Enge_pancreas_seurat_human_F/Enge_pancreas_seurat_human_seurat_obj
scp -r Enge_pancreas_seurat_human_F plyu3@omb2.onc.jhmi.edu:/zp1/data/plyu3/cellann_add_paper/
mkdir Muraro_pancreas_seurat_human_F
mv Muraro_pancreas_seurat_human Muraro_pancreas_seurat_human_F/Muraro_pancreas_seurat_human_seurat_obj
scp -r Muraro_pancreas_seurat_human_F plyu3@omb2.onc.jhmi.edu:/zp1/data/plyu3/cellann_add_paper/
mkdir Segerstolpe_pancreas_seurat_human_F
mv Segerstolpe_pancreas_seurat_human Segerstolpe_pancreas_seurat_human_F/Segerstolpe_pancreas_seurat_human_seurat_obj
scp -r Segerstolpe_pancreas_seurat_human_F plyu3@omb2.onc.jhmi.edu:/zp1/data/plyu3/cellann_add_paper/

#######
mkdir Wang_pancreas_seurat_human_F
mv Wang_pancreas_seurat_human Wang_pancreas_seurat_human_F/Wang_pancreas_seurat_human_seurat_obj
scp -r Wang_pancreas_seurat_human_F plyu3@omb2.onc.jhmi.edu:/zp1/data/plyu3/cellann_add_paper/
######
mkdir Xin_pancreas_seurat_human_F
mv Xin_pancreas_seurat_human Xin_pancreas_seurat_human_F/Xin_pancreas_seurat_human_seurat_obj
scp -r Xin_pancreas_seurat_human_F plyu3@omb2.onc.jhmi.edu:/zp1/data/plyu3/cellann_add_paper/
#####


#####
folder = "/zp1/data/plyu3/cellann_add_paper/Enge_pancreas_seurat_human_F"
load('/zp1/data/plyu3/Altas_add_CellAnn/Human_gene_convert')

#####
##### convert gene names of the cells #############
#####

Process_seurat <- function(folder){
	library(Seurat)
	setwd(folder)
	files = list.files()
	seurat_file = files[grep("_seurat_obj",files)]
	####
	seurat_obj = readRDS(seurat_file)
	####
	matrix = seurat_obj[['RNA']]@data
	####
	matrix_name = rownames(matrix)
	####
	k1 = which(matrix_name %in% gtf$gene_name == T)
	k2 = which(matrix_name %in% gtf$id == T)
	####
	print(length(k1))
	print(length(k2))
	####
	if(length(k1) < length(k2)){
		print('covert!!!!')
		m = match(matrix_name,gtf$id)
		m_index = which(is.na(m) == F)
	    ######
	    seurat_obj_cl = seurat_obj[m_index,]
	    ######
	    matrix_cl = seurat_obj_cl[['RNA']]@data
	    matrix_name_cl = rownames(matrix_cl)
	    #######
	    m_cl = match(matrix_name_cl,gtf$id)
		rownames(matrix_cl) = gtf$gene_name[m_cl]
		#######
		seurat_obj_cl2 <- CreateSeuratObject(matrix_cl)
		seurat_obj_cl2@meta.data = seurat_obj_cl@meta.data
		#######
		saveRDS(seurat_obj_cl2,file=seurat_file)
	}
}

Single-Cell Transcriptomics of the Human Endocrine Pancreas



Process_seurat("/zp1/data/plyu3/cellann_add_paper/Wang_pancreas_seurat_human_F")
Process_seurat("/zp1/data/plyu3/cellann_add_paper/Enge_pancreas_seurat_human_F")
Process_seurat("/zp1/data/plyu3/cellann_add_paper/Muraro_pancreas_seurat_human_F")
Process_seurat("/zp1/data/plyu3/cellann_add_paper/Segerstolpe_pancreas_seurat_human_F")
Process_seurat("/zp1/data/plyu3/cellann_add_paper/Xin_pancreas_seurat_human_F")

#### OK!!! ######
##### Process_seurat("/zp1/data/plyu3/cellann_add_paper/Baron_pancreas_seurat_human_F")

############# ############
############# ############
#############

A Single-Cell Transcriptome Atlas of the Human Pancreas
27693023


folder = "/zp1/data/plyu3/cellann_add_paper/Muraro_pancreas_seurat_human_F"
to = "/zp1/data/plyu3/CellAnn_batch9/"
TAG = "27693023_Human_Pancreas"

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


############## update the list ##########################
##############
Single-Cell Transcriptome Profiling of Human Pancreatic Islets in Health and Type 2 Diabetes

27667667
folder = "/zp1/data/plyu3/cellann_add_paper/Segerstolpe_pancreas_seurat_human_F"
to = "/zp1/data/plyu3/CellAnn_batch9/"
TAG = "27667667_Human_Pancreas"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

############

RNA sequencing of single human islet cells reveals type 2 diabetes genes
27667665

folder = "/zp1/data/plyu3/cellann_add_paper/Xin_pancreas_seurat_human_F"
to = "/zp1/data/plyu3/CellAnn_batch9/"
TAG = "27667665_Human_Pancreas"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

Single-Cell Transcriptomics of the Human Endocrine Pancreas
27364731
folder = "/zp1/data/plyu3/cellann_add_paper/Wang_pancreas_seurat_human_F"
to = "/zp1/data/plyu3/CellAnn_batch9/"
TAG = "27364731_Human_Pancreas"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



############
folder = "/zp1/data/plyu3/cellann_add_paper/Enge_pancreas_seurat_human_F"
to = "/zp1/data/plyu3/CellAnn_batch9/"
TAG = "28965763_Human_Pancreas"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

########### we need to add this !!!! ##################
###########


########### OK!!! next we will do the human big one !!! #########
###########

Construction of a human cell landscape at single-cell level

32214235

setwd('/zp1/data/plyu3/Altas_add_CellAnn/Human_cell_landscape')

seurat <- readRDS('local.rds')

########
########
library(Seurat)
seurat_split_obj <- SplitObject(seurat, split.by = "tissue")

names(seurat_split_obj)[45] = "embryonic stem cell"
######## ok first split the seurat objects and ... ######

load('/zp1/data/plyu3/Altas_add_CellAnn/Human_gene_convert')

for(i in 1:length(seurat_split_obj)){
	tag = names(seurat_split_obj)[i]
	tag = gsub(' ','_',tag)
	tag = gsub('_(cell_culture)','',tag)
	print(tag)
	####
	tmp_seurat = seurat_split_obj[[i]]
	####
	mat = tmp_seurat[['RNA']]@counts
	####
	m = match(rownames(mat),gtf$id)
	rownames(mat) = gtf$gene_name[m]
	k = which(is.na(rownames(mat)) == T)
	if(length(k) > 0){
		mat = mat[-k,]
	}
	####
	tmp_seurat2 = CreateSeuratObject(mat)
	tmp_seurat2@meta.data = tmp_seurat@meta.data
	tmp_seurat2$celltype = tmp_seurat2$cell_type
	####
	folder = paste0(tag,'_Human_cell_landscape')
	command = paste('mkdir',folder)
	system(command)
	####
	file = paste0(tag,'_Human_cell_landscape','/',tag,'_seurat_obj')
	####
	saveRDS(tmp_seurat2,file=file)
}


####

for(i in 1:length(seurat_split_obj)){
	tag = names(seurat_split_obj)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	######
	folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/Human_cell_landscape/",tag,'_Human_cell_landscape')
	######
	TAG = "32214235_Human_cell_landscape"
	TAG = paste0(TAG,'_',tag)
	####
	to = "/zp1/data/plyu3/Altas_add_CellAnn/Human_cell_landscape/"
	####
	Read_Seurat_file_in_the_folder_UCSC(folder)
	Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)
}


##### #####
##### #####
##### #####
##### #####
##### 
A human cell atlas of fetal gene expression
33184181

setwd('/zp1/data/plyu3/Altas_add_CellAnn/Human_atlas_fetal')
seurat <- readRDS('local.rds')

library(Seurat)

table(seurat$tissue)

seurat_split_obj <- SplitObject(seurat,split.by = "tissue")

#######
#######
#######
load('/zp1/data/plyu3/Altas_add_CellAnn/Human_gene_convert')

for(i in 1:length(seurat_split_obj)){
	tag = names(seurat_split_obj)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	####
	tmp_seurat = seurat_split_obj[[i]]
	####
	mat = tmp_seurat[['RNA']]@counts
	####
	m = match(rownames(mat),gtf$id)
	rownames(mat) = gtf$gene_name[m]
	k = which(is.na(rownames(mat)) == T)
	if(length(k) > 0){
		mat = mat[-k,]
	}
	####
	tmp_seurat2 = CreateSeuratObject(mat)
	tmp_seurat2@meta.data = tmp_seurat@meta.data
	tmp_seurat2$celltype = tmp_seurat2$cell_type
	####
	folder = paste0(tag,'_human_fetal_atlas')
	command = paste('mkdir',folder)
	system(command)
	####
	file = paste0(tag,'_human_fetal_atlas','/',tag,'_seurat_obj')
	####
	saveRDS(tmp_seurat2,file=file)
}


for(i in 1:length(seurat_split_obj)){
	tag = names(seurat_split_obj)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	######
	folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/Human_atlas_fetal/",tag,'_human_fetal_atlas')
	######
	TAG = "33184181_human_fetal_atlas"
	TAG = paste0(TAG,'_',tag)
	####
	to = "/zp1/data/plyu3/Altas_add_CellAnn/Human_atlas_fetal/"
	####
	Read_Seurat_file_in_the_folder_UCSC(folder)
	Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)
}



#######
########
#######
Mapping the de35549310veloping human immune system across organs

35549310
setwd("/zp1/data/plyu3/Altas_add_CellAnn/developing_human_immune_system")

seurat <- readRDS('local.rds')

library(Seurat)

table(seurat$tissue)

seurat_split_obj <- SplitObject(seurat,split.by = "tissue")



for(i in 1:length(seurat_split_obj)){
	tag = names(seurat_split_obj)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	####
	tmp_seurat = seurat_split_obj[[i]]
	####
	mat = tmp_seurat[['RNA']]@counts
	####
	m = match(rownames(mat),gtf$id)
	rownames(mat) = gtf$gene_name[m]
	k = which(is.na(rownames(mat)) == T)
	if(length(k) > 0){
		mat = mat[-k,]
	}
	####
	tmp_seurat2 = CreateSeuratObject(mat)
	tmp_seurat2@meta.data = tmp_seurat@meta.data
	tmp_seurat2$celltype = tmp_seurat2$cell_type
	####
	folder = paste0(tag,'_developing_human_immune')
	command = paste('mkdir',folder)
	system(command)
	####
	file = paste0(tag,'_developing_human_immune','/',tag,'_seurat_obj')
	####
	saveRDS(tmp_seurat2,file=file)
}

##
####
########
###############################################
########
####
##

##
####
########
####
##


for(i in 1:length(seurat_split_obj)){
	tag = names(seurat_split_obj)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	######
	folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/developing_human_immune_system/",tag,'_developing_human_immune')
	######
	TAG = "35549310_developing_human_immune"
	TAG = paste0(TAG,'_',tag)
	####
	to = "/zp1/data/plyu3/Altas_add_CellAnn/developing_human_immune_system/"
	####
	Read_Seurat_file_in_the_folder_UCSC(folder)
	Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)
}




##################
Cell Types of the Human Retina and Its Organoids at Single-Cell Resolution
###################

Organoid


Periphery


Fovea



##################
A multi-omics atlas of the human retina at single-cell resolution

PMID:31436334

##################
mkdir /zp1/data/plyu3/Altas_add_CellAnn/altas_human_retina

setwd("/zp1/data/plyu3/Altas_add_CellAnn/altas_human_retina")

cd /zp1/data/plyu3/Altas_add_CellAnn/altas_human_retina
mkdir All_major Amacrine Bipolar Photoreceptor Non_neuronal RGC HC

cd All_major
nohup curl -o local.h5ad "https://corpora-data-prod.s3.amazonaws.com/e8d49b1b-2828-45e8-b40a-a24b639d63a5/local.h5ad?AWSAccessKeyId=ASIATLYQ5N5X7XL4YWXK&Signature=Rjks7L3UQk03si0RnVp5enaE28M%3D&x-amz-security-token=IQoJb3JpZ2luX2VjELX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC9dv7AWVdZeOX06BocTnZ51%2F8N1pXv7GKridQuEqQbCwIhAJAayiqkelhs2xku9kkhXDV9v5twVaSXQXSuYtekhiCfKusDCD4QARoMMjMxNDI2ODQ2NTc1Igz5GgCiJ0Cf%2BXqu8g0qyAPKxCqSrPbuwwkKGkXLTN7O3kldNnA4xQirTX1dbXDZR5wSh2lJkLjU9gxhHnMb5S6F%2Bi9j26HQ%2B8wbqMTGh8YIT6zuAC7XKgEsJ6aV8fPQtL%2BLSPCuJvif3xMz%2BMSBRxJQaPRbhOWMPfZMSVZP9JOsw49VV8YKy0qGff3FiTe1TGTSzS1%2BuLsT%2F8zZKNhKO04rZcJqmmeFDRfSgjBuosgiKzR8mPBSJui4kZ3ODbXniz7K11JG%2Fwwu%2B%2BbfMxJ8MFy2ANPBBQsqJWdbUkRFbJQBpLIY4HIgxD7Ykn8%2B14ngjmKa9MuoNCAZs5h94fFPT2jAVpePr%2BC%2FLLTZoWctqqVkAlVNHUTUTjNovgGEymRY3ASd%2FY%2FafPCuuM%2Ftsj45YkBzTyVLaMC27RNmDK4I1TPji5s9LXGzSK1jLVv%2Feej0Uu4WgooE7knwQGRlyeIjzrxbfgMgEIA6pgMJn5i7toPsHP2L4jsc%2Fb%2BDU7uEIRz%2BWxEpZ7%2BmVyIzpIneVdRDwaZojKjvhzIyaoH4Kl6AoPBsphrWPjM%2FTeg0jDL2FIhRkkNR08mqjmKLEuXItcaFY0lrucMItzQ35zbsgTyuvmTk71FVYWLlnq8wi4OCnwY6pAFop%2BbVyel%2FYQE%2FrjCfYp3%2FpTbwpHC8QcHLoMmbimHtj6HwRL3uxXpHbD6zYkmBm1kQxkfSjH2a8PlzFYj3Ksbx6ycXYGf61P08ar7IjQQoPiikUw9sWFT7Xu6QmWz5jAUjy%2FrcUuriysb7Ke0jBtpNQYqCAjn1kgtLwfA%2FvWs5RafjcWOJcUD6bzKFm%2FP4%2FgveGz%2FxOxJ6xTHEP9kWrvP%2BCYw0qQ%3D%3D&Expires=1676277729" &

cd Amacrine
nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/ac499f12-7ee6-438a-9fa0-53240151d9be/local.rds?AWSAccessKeyId=ASIATLYQ5N5X2B4BE7PK&Signature=P0gDPxgngM3eXWkfAFAChVEMvHM%3D&x-amz-security-token=IQoJb3JpZ2luX2VjELT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIGxa4g%2BX%2FOS1%2FNhN%2FP1tKuXfkPbLd3rLQj2Mbpgz0d%2FbAiEA9M9zaFW2H%2FCNGF23xADtFU1%2Bl4qpVHcQBk2YtUSxNGcq6wMIPRABGgwyMzE0MjY4NDY1NzUiDBMGmEiEcPTAPX5mAyrIA6bp7%2BsHsSEK8YO0BmyxhKAjtVAkAwaTsNzYkQuUQ8S%2F39XG6KQvjsY8MsWgkZVrJApEf5MpSkoCHOEdLDxZ3acruyJNEPA42JsjI5%2FpVkeSPvFwkwWmOm8tlDs%2Bbt2RbtGi01PXn47DyO9rhk1BI5kRmACNzN%2B4IVsMDPQJ%2BHciaFJFj6icxF6gblrDmRTpjiAk7qiDKvXl27akj4kP98qaiLYvImagGTgn3Ud1E8jWCNzl6X6q%2F%2BhGbm8%2Bu%2FtUp0RwzSoEtDo5%2BBoDXOpROIOyXtZ5Ayerh%2BLrkIXMXRStVzQJg68lpYWuGM7%2FCAMp%2BTFe4pIi8v%2BT7OpqyctvC2YH8DfM7Xh5jt8sAaLFUfTBssxs1sFq30Ae2Yxn8vv%2FNr3xzRlrlpVfBZKIyU5Mogks9gJaiE%2BqPhgUx7VLxiNyq32ucOFNmFS%2B2kWXqP87RVuaSwr%2BK3ZmUmfQw7b9p2OeXRtKCfwrZxj3%2F9eoQXzLq626lJIDvok232bqo52fyaXP3dzA8wGBT48eNTOwyjlSUn%2FJjC5ahTpnBV7djVvyakm0gK2bIef6TRbLvo84n2s8ggbKe8%2F5EFo2KAOFPQxTZnwtvjKB2zCk9IGfBjqlAfNCABunbonLLz9F%2F0sngPfKjagTfb6itXnNAd7M4MC2CHwQtHuNVsnfnCtSbE6IQ82XSKb29MkMRDPMXX7MAoSDsqr7gZRofGfpPvCnrjVA86G1W1V99u99rG%2B4yzLIHdlkUIR2xArKWoe%2FXg%2F%2F%2FXJeV4%2FGqRgZSkS3F9YpA0cnjnGMgkRfaGkFxZ3eitmWBSKtMHT557O0RIk7cdDRbDFrR9zcxQ%3D%3D&Expires=1676277765" &

cd Bipolar
nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/6aeb5a98-120d-46b6-8286-c4ee4cf5595a/local.rds?AWSAccessKeyId=ASIATLYQ5N5XQMLMGJHV&Signature=IhJLlk6qzCr08CHZr8INsk26xEc%3D&x-amz-security-token=IQoJb3JpZ2luX2VjELn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCHB8MgzppF6dg2qtXcb%2FBmx74Z9f4bcgwcg8OkhbjRfwIhANVHzPaRbeOyGpXMHvmj0j56qkECMaoMtP9jNhL72YaJKusDCEIQARoMMjMxNDI2ODQ2NTc1IgzHGcO2H1xZArzkLa8qyAMB5NZk6Ep2bHDNox8vIpUr0mFl94WFSeKKaFIQczOcxS9U8nKLapOC7AO4519ZAzGeQsdAMw0qsBvFM4uX4qxMsg%2BlGFRy%2FBsVVoJPUyCNlopgsYUS8KyjsSzXYIgfXsErnMRrfFafy3G3hh9LuwLzHHELDOb2QtEnTGmaSzQKIYvFElmQCJi3NqGQCxVHb2Qmp6IorruI9Ho5h6WzIqjEI89iyrIzXYEfDBIN8sbLL3SHS%2FDeKF2r9HvNEi2wD%2B3c%2BF1RA5OvHOtVpViJe41oTPm8UHhlEyxAM%2ByX9W5%2BjkEWl5Y1AqZA1wInZERW0IOlGjNZkvEd%2FLy7IcWvijB2jltIf2Ou7%2BbBUrDl7gvd5uuAJLjLmoGw%2FyjjXySFKE9gHQ7%2BKndb7cRh2b62GmxN5L281Y7NgmpYOF8E8cYesxF%2BolPW%2F1nZGiLlwq735FwvG8yjBfAR5fPKK0NU57tbGSTMnXzh4m4fACE0C2JpOGKEEDp3d0bDT2ORzxpH%2FWM6nbWz0M9DeThxKujY0JVMoDVoFmyjnF5AlV9cYF6a6jUYmhBcWUFSprAVHTYbNXC7MeYgVNaFR5f7TG6mie2oDCZuLHzE5pIwp%2FKCnwY6pAEC4upuw7%2B2vPZhRooLLQ2VHl8agkKzZ5fsDhGteyGUtU9YC2on7diu5R33BCuYz1OmIIndnrWxuMc3Ril5XLRqAorWqgj4nUb5PSbLK2Mu%2BtFyX%2FFEecwFTQ4YhssaV%2FaArqcAgNd%2BlR7HAZpP5Oxx%2BKCKTOhcdnsZhQSrj0k%2BDSXFC1Pc4dJSnNIoe1ZgIIpbahXJZ3K0xTrexiXI2%2Bsl2my6Tg%3D%3D&Expires=1676277830" &

cd Photoreceptor
nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/67b60703-0d11-4f37-a4a7-d427ca9d095d/local.rds?AWSAccessKeyId=ASIATLYQ5N5X7XL4YWXK&Signature=eCzT5c4vLWhMmhwxlw%2FHomtY5ZY%3D&x-amz-security-token=IQoJb3JpZ2luX2VjELX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC9dv7AWVdZeOX06BocTnZ51%2F8N1pXv7GKridQuEqQbCwIhAJAayiqkelhs2xku9kkhXDV9v5twVaSXQXSuYtekhiCfKusDCD4QARoMMjMxNDI2ODQ2NTc1Igz5GgCiJ0Cf%2BXqu8g0qyAPKxCqSrPbuwwkKGkXLTN7O3kldNnA4xQirTX1dbXDZR5wSh2lJkLjU9gxhHnMb5S6F%2Bi9j26HQ%2B8wbqMTGh8YIT6zuAC7XKgEsJ6aV8fPQtL%2BLSPCuJvif3xMz%2BMSBRxJQaPRbhOWMPfZMSVZP9JOsw49VV8YKy0qGff3FiTe1TGTSzS1%2BuLsT%2F8zZKNhKO04rZcJqmmeFDRfSgjBuosgiKzR8mPBSJui4kZ3ODbXniz7K11JG%2Fwwu%2B%2BbfMxJ8MFy2ANPBBQsqJWdbUkRFbJQBpLIY4HIgxD7Ykn8%2B14ngjmKa9MuoNCAZs5h94fFPT2jAVpePr%2BC%2FLLTZoWctqqVkAlVNHUTUTjNovgGEymRY3ASd%2FY%2FafPCuuM%2Ftsj45YkBzTyVLaMC27RNmDK4I1TPji5s9LXGzSK1jLVv%2Feej0Uu4WgooE7knwQGRlyeIjzrxbfgMgEIA6pgMJn5i7toPsHP2L4jsc%2Fb%2BDU7uEIRz%2BWxEpZ7%2BmVyIzpIneVdRDwaZojKjvhzIyaoH4Kl6AoPBsphrWPjM%2FTeg0jDL2FIhRkkNR08mqjmKLEuXItcaFY0lrucMItzQ35zbsgTyuvmTk71FVYWLlnq8wi4OCnwY6pAFop%2BbVyel%2FYQE%2FrjCfYp3%2FpTbwpHC8QcHLoMmbimHtj6HwRL3uxXpHbD6zYkmBm1kQxkfSjH2a8PlzFYj3Ksbx6ycXYGf61P08ar7IjQQoPiikUw9sWFT7Xu6QmWz5jAUjy%2FrcUuriysb7Ke0jBtpNQYqCAjn1kgtLwfA%2FvWs5RafjcWOJcUD6bzKFm%2FP4%2FgveGz%2FxOxJ6xTHEP9kWrvP%2BCYw0qQ%3D%3D&Expires=1676277893" &

cd Non_neuronal
nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/9072178e-7633-47fc-aabb-2303948b5da0/local.rds?AWSAccessKeyId=ASIATLYQ5N5XZ4OK7LZ6&Signature=EybxcU9dMS7ys50oOI8wiAh9VTM%3D&x-amz-security-token=IQoJb3JpZ2luX2VjELf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIACBvhq4xSKb%2Fi%2BP6PB2SncWuJHrG%2FCsCerrMDP%2FH4YUAiADSmQWaYICtWq02uJN1Fka553gE%2BUN70ez6JUih00g0SrrAwhAEAEaDDIzMTQyNjg0NjU3NSIMz2sesycCNasadTusKsgD%2BPDfxymcX6jZnmSWNdOAUEh63NCFAzN85G6lgzsFU2Wjr8Tv5VUstl6VeWtf6N7tDeJo9FkExSOSPg9cU2bAnBvx55kbGow1tgKdkBNHGxBa%2F86FaflHdJDdTCh0gs%2FJRj93IWs5qZAn0QxwHt%2BcjIiZrrg8mKk1me%2FaZAp7bCHB%2B%2F469TP1mtZgJ16aBf7F%2BBQCFWv%2FJ7opqtAnK%2FXIHmUV7HFnrT1DS886IQdai9phcA11Ay2C322qycmNe7xCkfb2SBVTb2Ohl6PQkrVKLYLQ2QFJcrGreQMBVaUayFv74%2FkDGba%2BaWSzVI1XE3sAs%2B%2BPYhgu7CSUzxm0HAvVHbjhclaQ%2FtvJc1Ypq%2BjUcqjpDc5kBOTq8UphfB%2Bojdxa3G%2Flvca051ou57RWL4dVn0UMqrY6EZrg%2FT%2BCEy2IbeWvobPyv1uvvlWQ3J6j12H9wRZckLzxJ7wmwAVwaHk%2BKKyUObdc8Wd0DZdBWlaVrR3p0PZewkizgCLXSt6SVlnJ5xVpgeYd4TsfCk6SAmrcQF6UhHcquBkqECOF0ZbLWbgafrBPD6IC7NeCsn6ysAYTFgXmCOakp7Q08XqlWMINDA6TEI4HZrMQMLHQgp8GOqYBN%2Fsvu6s30GjaM1iqKs89cs1DsQ8XHCN1T20TMQSVP2IytKWzUEB2agqc8vZilEarKhM7ZMFvSqs0napS1zmw4zSjwHDzmVDw1Im5WP5AR6JOT6pv7xivlNjP9%2Bqkqulaf%2BXO0XSYMIFO3xGeboh2v0TDbOw2rsbk255RDihvm8shwDuEshpvPTUB%2BFdNE08iJLP5MlGcgRIoIgfgk%2By1FIdn4ycPCw%3D%3D&Expires=1676277952" &

cd RGC
nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/463f1797-cd1e-4e5d-83f8-dfad41f6ff0b/local.rds?AWSAccessKeyId=ASIATLYQ5N5XQ7MWQK6E&Signature=n2%2BqqEq7hOKYAOyo%2F%2FtNS%2BtVCKM%3D&x-amz-security-token=IQoJb3JpZ2luX2VjELT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIGQKbqsxKJH%2BXg8IjlpvszSefIJ9gZFCbJR26qfJfbBVAiEAnp%2BnxsybGIuLGJurXXbFuApNyk%2Bfo%2BuHR9vo%2BM2NNRAq6wMIPRABGgwyMzE0MjY4NDY1NzUiDJdEiQ5FnNC0MyP71irIA888tTjwif%2BFTCtDiTPehSuvA9ijW2IOhvTsGmSH2zUr6HB1zRbG0%2BhGZUtsjDHqHDH%2FSkOjqreHR9i1QUDokxVcEnuBTF6kaulM3dqYLOhrb8XLywkBJ3q5in9td87HurhEWD%2BjC2zk3w5ZZcAXHuxlxJMS8HylFF1lmsU4%2BEA5HlvSl25a7iNAWIF3MBglv8cH37GwxAWbskyqq9uxKtuBYiJ%2FK3BxzSrXhZHDjY2Y09voljPv4VrtDLHCNK33dTBhgsNqLY%2F4ufuXqb%2BoL1Llu0r%2FI6OXmnHfsftkauoSgHQix2vdetuoXDVUQ16V5zU9bS5TBhqlTKgWxSVM%2FgUrUko0HlZywlV6XwtBYQB0%2BiwG%2BOnTUMqBQEUM%2FlpyNfMfVyeQV0eXypvbq1NYtUzK7gWTcovj1VophMn5a2HtAKtp9lrVcx%2Bz6Az%2Flktyjvdaa6gZ712u3e%2B9ErjTiFTFoSGCoBg43VMy5v49JAGhoWXo%2FvxJBHdqAfbGqbeizzFR7yFxI8mvcz0G6uVLQtj47aO6O4vk8UMCKFrnTi%2BLMj0LhwU9rHZnW35bA3FVFqF9B8ORCVm1nC7EKlMMA9edQrhcjTDddDDX8YGfBjqlARhx4aL6Gu8wwwo0EhJ5cdvYRq7Ov%2BZuBtqbQnEnWaNsFOyRhOgivrzhF6fJl8XFKkofwC5ct4KV9hopQb7lY8Ltt9PSnHwDN7PBsxbs%2FC%2FM3qyrvn4Kmt643ydcUPB9AaV9w9fmhHTA%2BicgquXg82G4vSzBQh8vO6egBCDYDQyLkSulrUy%2FWUkQltS9sF%2B1Pf%2FCWvDKN8rJ5CS6TzzLgdK2dbrnBw%3D%3D&Expires=1676278026" &

cd HC
nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/485617a5-d8dd-401a-ac52-f3d815d97ef3/local.rds?AWSAccessKeyId=ASIATLYQ5N5X7XL4YWXK&Signature=wpnCcbB8clBCfDIHINnPoqKGSjQ%3D&x-amz-security-token=IQoJb3JpZ2luX2VjELX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC9dv7AWVdZeOX06BocTnZ51%2F8N1pXv7GKridQuEqQbCwIhAJAayiqkelhs2xku9kkhXDV9v5twVaSXQXSuYtekhiCfKusDCD4QARoMMjMxNDI2ODQ2NTc1Igz5GgCiJ0Cf%2BXqu8g0qyAPKxCqSrPbuwwkKGkXLTN7O3kldNnA4xQirTX1dbXDZR5wSh2lJkLjU9gxhHnMb5S6F%2Bi9j26HQ%2B8wbqMTGh8YIT6zuAC7XKgEsJ6aV8fPQtL%2BLSPCuJvif3xMz%2BMSBRxJQaPRbhOWMPfZMSVZP9JOsw49VV8YKy0qGff3FiTe1TGTSzS1%2BuLsT%2F8zZKNhKO04rZcJqmmeFDRfSgjBuosgiKzR8mPBSJui4kZ3ODbXniz7K11JG%2Fwwu%2B%2BbfMxJ8MFy2ANPBBQsqJWdbUkRFbJQBpLIY4HIgxD7Ykn8%2B14ngjmKa9MuoNCAZs5h94fFPT2jAVpePr%2BC%2FLLTZoWctqqVkAlVNHUTUTjNovgGEymRY3ASd%2FY%2FafPCuuM%2Ftsj45YkBzTyVLaMC27RNmDK4I1TPji5s9LXGzSK1jLVv%2Feej0Uu4WgooE7knwQGRlyeIjzrxbfgMgEIA6pgMJn5i7toPsHP2L4jsc%2Fb%2BDU7uEIRz%2BWxEpZ7%2BmVyIzpIneVdRDwaZojKjvhzIyaoH4Kl6AoPBsphrWPjM%2FTeg0jDL2FIhRkkNR08mqjmKLEuXItcaFY0lrucMItzQ35zbsgTyuvmTk71FVYWLlnq8wi4OCnwY6pAFop%2BbVyel%2FYQE%2FrjCfYp3%2FpTbwpHC8QcHLoMmbimHtj6HwRL3uxXpHbD6zYkmBm1kQxkfSjH2a8PlzFYj3Ksbx6ycXYGf61P08ar7IjQQoPiikUw9sWFT7Xu6QmWz5jAUjy%2FrcUuriysb7Ke0jBtpNQYqCAjn1kgtLwfA%2FvWs5RafjcWOJcUD6bzKFm%2FP4%2FgveGz%2FxOxJ6xTHEP9kWrvP%2BCYw0qQ%3D%3D&Expires=1676278082" &



###########
###########
########### OK！！！ let us get mouse datasets ！！！！ ############
########### another altas ########################################
###########
###########
Lung

Genomic, epigenomic, and biophysical cues controlling the emergence of the lung alveolus

PMID: 33707239

cd /zp1/data/plyu3/Altas_add_CellAnn/

mkdir LungMAP_Mouse

nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/110496d2-9be8-4df3-a38a-4496efd987fe/local.rds?AWSAccessKeyId=ASIATLYQ5N5XRYVBVZ6N&Signature=IFBKkJ5C4Dz5%2FPrDj3NbVIWDkok%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEBcaCXVzLXdlc3QtMiJHMEUCIQCLuIMqUph8Z4pcu0NF2gUSXZe9YHu59iQsM362kJSoPgIgRx54uKZo2BNvVw%2FKQRc5JbwVxlr9BVv9sBTdIrGHUZAq9AMIoP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARABGgwyMzE0MjY4NDY1NzUiDMXCdLNmd7XmhQdtSirIA%2FM4%2Fx5w8CmpVWi%2FixVtQO%2BZFipaqLqGLWoxQejI7boIcM%2F%2FHaIhkfl1sV6PD3M9GOmekNNWZXb71HqqWhthqNi5ahRuIjimrNVh2Kst09glW78VHG5APzf1Hwj%2FozlIgcwZXEJ0W9RnxZUHztONYHiXfA1GeiLkESwaFZpy7B8r6TcL4kzOjes9nv0z49VtVhV3D315zFm81Gkv4gRV3gaspVhlOHmdU9YYevyFZGgqwOR5ayVeG7%2B8DeKJN%2Bp0HMUTkpyoo1Q3CTGnwxjQYZzC8illl3Gmgelj15BCssSbMSSUOL1AJkcKlwKxC4kY%2FAvTbRb0ySkyryBaedVzJP%2FPW3QCZi211ebBCcIb95PyaC1FLZ%2Fmx%2BDWh4b02z%2F%2B36CEZffmuYq4hE%2B8I9jGaMOhcvcg%2FFTckU1UnL0Nppejrc5cxnwTh5EuQuUeMs5pcdH3o%2BpcFke47VSbPf36Wv5lqd2V86x6r%2FuzxkVH8DHM7oJdjBtIO49sttIxAK84QGLYXYfOlJOqhnZvDISiImos%2Bf%2BHYsTVyiF6LYH0m5u5XFlwIxTQGCvliyN3X2oIhTlJlOBkfQ3ZphY34i9ls0I95ds2qZw%2BtzCF05efBjqlAQEvzpd99FsmBMT6R22SppF2mg782TNEYqh9Zc4I5Ql%2BU88KRwHEC2rHkoqDvXPF%2BSQvqWATyZhZlpn0KWgSkhRLQo%2BfurOAS9xfALHrxesDzboP92MEGwXp0s7zqzyr0csX%2FBO8SaKoiQ619%2BR%2BlunJEIDkRfZQXC6J48R5a2UlGyVRnyAMEWNip%2FxzzcAv5090M7OZI38XCOWokV41uIuicHTfiA%3D%3D&Expires=1676631986" &

TAG = "33707239_LungMAP_Mouse"

setwd("/zp1/data/plyu3/Altas_add_CellAnn/LungMAP_Mouse")

seurat <- readRDS('local.rds')

library(Seurat)

head(seurat@meta.data)

table(seurat$development_stage)

seurat_obj = Convert_Mat_to_Symbol(seurat,sp='M')
seurat_obj$celltype = seurat_obj$cell_type
seurat_obj_sp = SplitObject(seurat_obj,split.by="development_stage")

###########
###########
###########

for(i in 1:length(seurat_obj_sp)){
	tag = names(seurat_obj_sp)[i]
	tag = gsub(' ',"_",tag)
	folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/LungMAP_Mouse/",tag)
	#######
	file = paste0(tag,"_seurat_obj")
	#######
	command = paste("mkdir",folder)
	system(command,wait=T)
	#######
	setwd(folder)
	saveRDS(seurat_obj_sp[[i]],file=file)
}



for(i in 1:length(seurat_obj_sp)){
	tag = names(seurat_obj_sp)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	######
	folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/LungMAP_Mouse/",tag)
	######
	TAG = "33707239_LungMAP_Mouse"
	TAG = paste0(TAG,'_',tag)
	print(TAG)
	####
	to = "/zp1/data/plyu3/CellAnn_batch21/"
	####
	Read_Seurat_file_in_the_folder_UCSC(folder)
	Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)
}





###########
###########
###########




###########
########### OK！！！Then we process this sample ！！！ ####
###########



########### then we update the total list !!! ########
########### Next !!! #################################

Mouse pancreatic islet scRNA-seq atlas across sexes, ages, and stress conditions including diabetes

PMID: GSE211799

cd /zp1/data/plyu3/Altas_add_CellAnn/

mkdir Mouse_pancreatic_islet

nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/49e4ffcc-5444-406d-bdee-577127404ba8/local.rds?AWSAccessKeyId=ASIATLYQ5N5XZSU5N6HN&Signature=0riiGPODT5XtgS19E90JWztH0BU%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEBoaCXVzLXdlc3QtMiJGMEQCIFFLo55A%2FNitHgRrdrRCRCBKBoR8CAX4RdW1qPcCLG%2FVAiB9zY7t8ofJZnPX4zGJzqaY8LhsyQpLQ7mj6bAhBrjd6yr0Awij%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAEaDDIzMTQyNjg0NjU3NSIMtRfeutZsxeuB4Wt3KsgDqjCMg0w02PUU1A7%2FiD99lifHqzBUo%2BuNUNcGiMY67yQqU5Xy5hGqoXcrTSpcHLEDDkUOnxFjNlOqFFvUtWoF%2BXdfOYFPdmskxH8da%2FDb9YzN30bxeaUi7SlEQwiy2PnZvF5GuC5K5BQll3hNzMW%2BumkaCDHlxHBgUQHElvDA56lPjPkAeS9gTEmYJ2kKMUXzRskQki1qEsxfkb8FASpth2YVQul6z3c1BrF%2BP4JvTB2KhZT3Ll4DLMDpNtvGecvP9pIMiG0CfriFgs0RZUAOB0hR2O1utcMdzhMTtXeviNbJrI3p61xMFZHk9e1KX%2BNMC%2BI44K97CBltDe%2FUofM1byov8dSZfiV6RCYDgFqD50yra5nB7U98s0lDa98l66334yI8InTc2fOKMrC755qqcipzvYsPQsuPa69pG5mdcVOjXrkT1tLWVFhbyn8CsyPIKEdrcMWA9DVOvwTN5YYAZ0Hir2v78I%2Ff%2FXoE%2FOwVRZbkcokdX5z41EGmGz9XSnopjvCaRis7vgvtalsQEFaTn2vM5AZMe0QRlXHANW2%2F1v6t37XyX1%2BggJhvpEKIfqfxmky3%2FJlHdaeF6Oe%2BTf%2FrlFzbBUlZtMmRMJ6lmJ8GOqYBqUxAIenjiBhHpIy%2FiBDxTmwHUtt4UJhuz56%2FQp1zR6SZwx%2FzB8E%2Bvid%2FQ6JjddtFaEhF7YANUxGe%2BeEEOEH4I5vQTFfKXfQKNOSp%2Bl6QV7EqlZeUlF9BIzJsEfWpoGJpmekvgZBIRsly7KqFVpen8S7NyLq21SgUo3oA4fKjDHNty8cEdYxpr98u%2FpYflH7kRIxgJFcOy%2FhL8BzSTWByOpUH0VU4tg%3D%3D&Expires=1676632723" &

TAG = "GSE211799_Mouse_pancreatic"

setwd("/zp1/data/plyu3/Altas_add_CellAnn/Mouse_pancreatic_islet")

seurat <- readRDS('local.rds')

library(Seurat)

head(seurat@meta.data)

table(seurat$development_stage)

##########
table(seurat$development_stage)

##########

table(seurat$development_stage)

seurat_obj = Convert_Mat_to_Symbol(seurat,sp='M')
seurat_obj$celltype = seurat_obj$cell_type
seurat_obj_sp = SplitObject(seurat_obj,split.by="development_stage")




for(i in 1:length(seurat_obj_sp)){
	tag = names(seurat_obj_sp)[i]
	tag = gsub(' ',"_",tag)
	folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/Mouse_pancreatic_islet/",tag)
	#######
	file = paste0(tag,"_seurat_obj")
	#######
	command = paste("mkdir",folder)
	system(command,wait=T)
	#######
	setwd(folder)
	saveRDS(seurat_obj_sp[[i]],file=file)
}





for(i in 1:length(seurat_obj_sp)){
	tag = names(seurat_obj_sp)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	######
	folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/Mouse_pancreatic_islet/",tag)
	######
	TAG = "GSE211799_Mouse_pancreatic"
	TAG = paste0(TAG,'_',tag)
	print(TAG)
	####
	to = "/zp1/data/plyu3/CellAnn_batch23/"
	####
	Read_Seurat_file_in_the_folder_UCSC(folder)
	Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)
}

##########



##########
A transcriptional cross species map of pancreatic islet cells
PMID: 36113773

cd /zp1/data/plyu3/Altas_add_CellAnn/

mkdir Mouse_pancreatic_islet_cells

cd Mouse_pancreatic_islet_cells

nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/ec9dac29-0282-4ce8-a6b8-ae4c4bdadd37/local.rds?AWSAccessKeyId=ASIATLYQ5N5XRYVBVZ6N&Signature=ojz8K79Y0HyNh4FwT7TnCU5qG7c%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEBcaCXVzLXdlc3QtMiJHMEUCIQCLuIMqUph8Z4pcu0NF2gUSXZe9YHu59iQsM362kJSoPgIgRx54uKZo2BNvVw%2FKQRc5JbwVxlr9BVv9sBTdIrGHUZAq9AMIoP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARABGgwyMzE0MjY4NDY1NzUiDMXCdLNmd7XmhQdtSirIA%2FM4%2Fx5w8CmpVWi%2FixVtQO%2BZFipaqLqGLWoxQejI7boIcM%2F%2FHaIhkfl1sV6PD3M9GOmekNNWZXb71HqqWhthqNi5ahRuIjimrNVh2Kst09glW78VHG5APzf1Hwj%2FozlIgcwZXEJ0W9RnxZUHztONYHiXfA1GeiLkESwaFZpy7B8r6TcL4kzOjes9nv0z49VtVhV3D315zFm81Gkv4gRV3gaspVhlOHmdU9YYevyFZGgqwOR5ayVeG7%2B8DeKJN%2Bp0HMUTkpyoo1Q3CTGnwxjQYZzC8illl3Gmgelj15BCssSbMSSUOL1AJkcKlwKxC4kY%2FAvTbRb0ySkyryBaedVzJP%2FPW3QCZi211ebBCcIb95PyaC1FLZ%2Fmx%2BDWh4b02z%2F%2B36CEZffmuYq4hE%2B8I9jGaMOhcvcg%2FFTckU1UnL0Nppejrc5cxnwTh5EuQuUeMs5pcdH3o%2BpcFke47VSbPf36Wv5lqd2V86x6r%2FuzxkVH8DHM7oJdjBtIO49sttIxAK84QGLYXYfOlJOqhnZvDISiImos%2Bf%2BHYsTVyiF6LYH0m5u5XFlwIxTQGCvliyN3X2oIhTlJlOBkfQ3ZphY34i9ls0I95ds2qZw%2BtzCF05efBjqlAQEvzpd99FsmBMT6R22SppF2mg782TNEYqh9Zc4I5Ql%2BU88KRwHEC2rHkoqDvXPF%2BSQvqWATyZhZlpn0KWgSkhRLQo%2BfurOAS9xfALHrxesDzboP92MEGwXp0s7zqzyr0csX%2FBO8SaKoiQ619%2BR%2BlunJEIDkRfZQXC6J48R5a2UlGyVRnyAMEWNip%2FxzzcAv5090M7OZI38XCOWokV41uIuicHTfiA%3D%3D&Expires=1676633955" &
 
TAG = "36113773_Mouse_pancreatic"

setwd("/zp1/data/plyu3/Altas_add_CellAnn/Mouse_pancreatic_islet_cells")

seurat <- readRDS('local.rds')

library(Seurat)

head(seurat@meta.data)

table(seurat$treatment)

########### No need to split !!! #########
##########

seurat_obj = Convert_Mat_to_Symbol(seurat,sp='M')
seurat_obj$celltype = seurat_obj$cell_type

saveRDS(seurat_obj,file="36113773_Mouse_pancreatic_seurat_obj")

folder = "/zp1/data/plyu3/Altas_add_CellAnn/Mouse_pancreatic_islet_cells"
Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)

###########
###########
###########

to = "/zp1/data/plyu3/CellAnn_batch23/"
TAG = "36113773_Mouse_pancreatic"
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



###########
###########



cd /zp1/data/plyu3/Altas_add_CellAnn/

mkdir Human_pancreatic_islet_cells

cd Human_pancreatic_islet_cells

nohup curl  -o local.rds "https://corpora-data-prod.s3.amazonaws.com/ca9e7e2b-6c82-4b79-92c9-47d306d5d409/local.rds?AWSAccessKeyId=ASIATLYQ5N5X5XRIYQB3&Signature=4iU%2Fc5L8jvU5YAENVjTLeXOEsdk%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEBoaCXVzLXdlc3QtMiJHMEUCIAniLnbzlR%2BMNOH0uOV7oIrxD5IHdPpd5F56tLA22S8wAiEAqapVyG28FHjQwpPJJ0u3xrhJxdw7g%2BCA2sJgMVnOC2Mq9AMIo%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARABGgwyMzE0MjY4NDY1NzUiDEti8NBTdp5QQ0k7OCrIA5temgOS611L97RF9TAK76mGgLqEZSjwbaY4CHYHOOrxN7QlgcSHbJtroXmjXmR78FmspMQ2%2BjvlsYICn7Ncp45NJLgZkwnlMFMv8sXYUhLqEKndr%2BIr4eqLoFM2Nyn6dxOjrLbAKI%2BT1u%2FQoLV0dAHfXeEV1MBKlX1VCXXKa6eriMYCjjbg9%2Fptrz%2F1c%2FEFSsbhwat66B%2FK%2BMobSgKhOR2HTJUN2QH44Z73FV9xT4cOSLkXzeoqyKxCeT1%2FtPjM4%2Bgwng%2BbTT9S6vcrdgOd68IF4btqlh%2B8hFoqWaCbb22evKo9teHZy2CI9KSg%2B5S6GwHj0rM1WwKYvjdkK48qUfCzImTSsQs%2Bcwaflql3XHK0QVEUVJ7G3BzvMH3YGf%2FcL170dqHGVZ0nQNbMkuUXlt5TMuPlVp%2BQMSUM%2B22Q4vnvVEEDuZZt6UGKK4gNueJSteCSC0sqqHg%2FaPghs5lfeMkvdR%2BsIDMWqaDlWJ3CbBfpRfVBOxsp5%2FltW%2Br7rZV3TzK%2BGVhRv1165FkkV9ccfj%2B39eLEmPz3i90FN3rUZ83ogHa0qji2hFAv5eHF3lEoOSjeDsNJXhxol%2BqyLDrvgZMZYhNSiX%2BeJzDhmZifBjqlAe5KgtiXbmhv2TGPBAe6hxS7eN784g5mWcjdNrCmqhWehsTOErCUolO49FjbOFKSQ2H2xviy%2Bx4rnfyXb5h3Z0CMd1VYMhmdlOxhaSrDJuEMJF5Rbc0ZO%2F686tGD83XFIl27%2BnQU0zR6cSMtfjlUrFM41Ir3RDPiW%2BptQEijua7ElxZ8ZVyBk2ZXS2l%2FD5%2BTi1Ghft%2FxKiZc5nDRINOY9%2BojOatE2A%3D%3D&Expires=1676634010" &
 
TAG = "36113773_Human_pancreatic"

setwd("/zp1/data/plyu3/Altas_add_CellAnn/Human_pancreatic_islet_cells")

seurat <- readRDS('local.rds')

library(Seurat)

head(seurat@meta.data)

table(seurat$development_stage)

seurat_obj = Convert_Mat_to_Symbol(seurat,sp='H')
seurat_obj$celltype = seurat_obj$cell_type
seurat_obj_sp = SplitObject(seurat_obj,split.by="development_stage")

####################################
####################################

for(i in 1:length(seurat_obj_sp)){
	tag = names(seurat_obj_sp)[i]
	tag = gsub(' ',"_",tag)
	folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/Human_pancreatic_islet_cells/",tag)
	#######
	file = paste0(tag,"_seurat_obj")
	#######
	command = paste("mkdir",folder)
	system(command,wait=T)
	#######
	setwd(folder)
	saveRDS(seurat_obj_sp[[i]],file=file)
}


#########
#########

for(i in 1:length(seurat_obj_sp)){
	tag = names(seurat_obj_sp)[i]
	tag = gsub(' ','_',tag)
	print(tag)
	######
	folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/Human_pancreatic_islet_cells/",tag)
	######
	TAG = "36113773_Human_pancreatic"
	TAG = paste0(TAG,'_',tag)
	print(TAG)
	####
	to = "/zp1/data/plyu3/CellAnn_batch23/"
	####
	Read_Seurat_file_in_the_folder_UCSC(folder)
	Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)
}

#############

setwd("/zp1/data/plyu3/CellAnn_batch23")
files = list.files()
files = files[grep("36113773_Human_pancreatic",files)]
files = files[!duplicated(files)]
files = gsub("pmid","",files)
files = gsub("_avg_sub_mat","",files)
files = gsub("_avg_mat","",files)

files = gsub("_Dimplot","",files)
files = gsub("_marker","",files)
files = gsub("_sub_marker","",files)
files = gsub("_sub","",files)
files = files[!duplicated(files)]

###########
###########
###########
###########



###########
Single cell analysis of mouse and human prostate reveals novel fibroblasts with specialized distribution and microenvironment interactions

PMID:34173975

cd /zp1/data/plyu3/Altas_add_CellAnn/

mkdir human_prostate

cd human_prostate

nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/57dfca09-0482-464a-97eb-f583a6ebe00f/local.rds?AWSAccessKeyId=ASIATLYQ5N5XWS5Y76IH&Signature=llGfUi67aPBmum9y4AJMSaXMHiQ%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEBoaCXVzLXdlc3QtMiJIMEYCIQDXFGIGVvBw35PxN2LhSWQq0ArLhSDYDptZQZy1fz3zuAIhAL2KWM9g7q96Uk0EktKDmGtKjWNi53HrZ5knL2Du294OKvQDCKP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQARoMMjMxNDI2ODQ2NTc1IgwXcCtVvGizH6FK34sqyAP0ffNF8YgVPrjraRxGTOU3whOvq%2FP%2BUMpjMGOZOnoSfmVHLmqw3%2FokEP5%2BVBkSom6QhYhsuDa74ga%2Frhn2f9%2FX8%2F8pdODqvLPRw%2FIXSmky0a1fdxPjMBQiU3weiUELyz29Z0683mS%2FDQU5AEaHTSJIs4ZICSZsdcVy5JrixodfCk7cKBDxWKgeREXKnCd25khAxN8ZsOs4avfOgDdA3peUHoeYuF8BZC%2FIA73LRE21pcXUsqkz26ZaiGCmW2jQHAGjDC79uL9pbdBtqOhSnwfD8ff3KtOOh8etSQrnLPB9x3k1MxpAWj30sHjjJjZnLobd5o22B2VToPgU7z%2FvCGsfUoPCddBcmGxe1JPgCdKcYLIKAEuNlPaXlpTWfTv%2BAybmwHY6GNl7mmY77Hkn3LKOcJDQyc3ZT479sCb1IjcNTLtPvWDsF7fcxJPZF7Rz3leKmDHR%2BzCuo0mKmDWVYwKkFdlnKorZRqR7TP0tF5dvxXOVoI3BHLRe1ItSLdNUKrB52FaJl6stM%2BbvUoxRRoYQhGGt6Wl2qiSnnnir3irDmQV6gfJx6dvWNcypSQMjupGujRD4SNDgReHQWodbmxB4z0IwhRYDyNMw%2B6SYnwY6pAEj3vumI9ACqgIWhaQrh6OPM8OXdHbMqxF3YQphCL9kUQ1LEu6GKB1LI7lGgigwwGnBUD7oEERfcSqU5QZDDK4jcxZYHUW9N7fovRneoZgbRPthnPRzkjkH8mXNOKO9KgAvTnE%2FIpq%2BurlOC%2B7%2BjLiJEG3QRDY%2F5lwdL03fphECbc1zGCGPi2Kf3HLRJ2IA8dZCsRbuU6yx%2BhsI%2B8TSjylB4fKaSg%3D%3D&Expires=1676635914" &

TAG = "34173975_Human_prostate"


#############
library(Seurat)

setwd("/zp1/data/plyu3/Altas_add_CellAnn/human_prostate")

############# 没有 celltype ！！！ ########

human_prostate_seurat = readRDS("local.rds")

human_prostate_seurat$celltype = human_prostate_seurat$cell_type

human_prostate_seurat <- Convert_Mat_to_Symbol(human_prostate_seurat,sp="H")

saveRDS(human_prostate_seurat,file="34173975_Human_prostate_seurat_obj")

#############
folder = "/zp1/data/plyu3/Altas_add_CellAnn/human_prostate"
input_folder = folder

TAG = "34173975_Human_prostate"

#############

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


####
#### Next we will process these samples ######
####

cd /zp1/data/plyu3/Altas_add_CellAnn/
mkdir mouse_prostate
cd mouse_prostate
nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/2f56758b-7366-41fb-8a3c-b673b1b1bd7e/local.rds?AWSAccessKeyId=ASIATLYQ5N5XWS5Y76IH&Signature=pvbvNVgXtz15ykNK6lLWJ2zjXCU%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEBoaCXVzLXdlc3QtMiJIMEYCIQDXFGIGVvBw35PxN2LhSWQq0ArLhSDYDptZQZy1fz3zuAIhAL2KWM9g7q96Uk0EktKDmGtKjWNi53HrZ5knL2Du294OKvQDCKP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQARoMMjMxNDI2ODQ2NTc1IgwXcCtVvGizH6FK34sqyAP0ffNF8YgVPrjraRxGTOU3whOvq%2FP%2BUMpjMGOZOnoSfmVHLmqw3%2FokEP5%2BVBkSom6QhYhsuDa74ga%2Frhn2f9%2FX8%2F8pdODqvLPRw%2FIXSmky0a1fdxPjMBQiU3weiUELyz29Z0683mS%2FDQU5AEaHTSJIs4ZICSZsdcVy5JrixodfCk7cKBDxWKgeREXKnCd25khAxN8ZsOs4avfOgDdA3peUHoeYuF8BZC%2FIA73LRE21pcXUsqkz26ZaiGCmW2jQHAGjDC79uL9pbdBtqOhSnwfD8ff3KtOOh8etSQrnLPB9x3k1MxpAWj30sHjjJjZnLobd5o22B2VToPgU7z%2FvCGsfUoPCddBcmGxe1JPgCdKcYLIKAEuNlPaXlpTWfTv%2BAybmwHY6GNl7mmY77Hkn3LKOcJDQyc3ZT479sCb1IjcNTLtPvWDsF7fcxJPZF7Rz3leKmDHR%2BzCuo0mKmDWVYwKkFdlnKorZRqR7TP0tF5dvxXOVoI3BHLRe1ItSLdNUKrB52FaJl6stM%2BbvUoxRRoYQhGGt6Wl2qiSnnnir3irDmQV6gfJx6dvWNcypSQMjupGujRD4SNDgReHQWodbmxB4z0IwhRYDyNMw%2B6SYnwY6pAEj3vumI9ACqgIWhaQrh6OPM8OXdHbMqxF3YQphCL9kUQ1LEu6GKB1LI7lGgigwwGnBUD7oEERfcSqU5QZDDK4jcxZYHUW9N7fovRneoZgbRPthnPRzkjkH8mXNOKO9KgAvTnE%2FIpq%2BurlOC%2B7%2BjLiJEG3QRDY%2F5lwdL03fphECbc1zGCGPi2Kf3HLRJ2IA8dZCsRbuU6yx%2BhsI%2B8TSjylB4fKaSg%3D%3D&Expires=1676635951" &
TAG = "34173975_Mouse_prostate"
setwd("/zp1/data/plyu3/Altas_add_CellAnn/mouse_prostate")
mouse_prostate_seurat = readRDS("local.rds")
mouse_prostate_seurat$celltype = mouse_prostate_seurat$cell_type

mouse_prostate_seurat <- Convert_Mat_to_Symbol(mouse_prostate_seurat,sp="M")

saveRDS(mouse_prostate_seurat,file="34173975_Mouse_prostate_seurat_obj")

folder = "/zp1/data/plyu3/Altas_add_CellAnn/mouse_prostate"

TAG = "34173975_Mouse_prostate"


########
to = "/zp1/data/plyu3/CellAnn_batch20/"

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)

#####
#####
#####
#####

tmp_seurat = readRDS("/zp1/data/plyu3/Altas_add_CellAnn/Mouse_kidney_atlas/2_month-old_stage/2_month-old_stage_seurat_obj")



##########
########## Not processed !!!!! ######
##########


###########
###########
A comprehensive mouse kidney atlas enables rare cell population characterization and robust marker discovery

PMID:bioRxiv_Novella_Rausell

cd /zp1/data/plyu3/Altas_add_CellAnn/
mkdir Mouse_kidney_atlas
cd Mouse_kidney_atlas

nohup curl -o local.rds "https://corpora-data-prod.s3.amazonaws.com/594690a6-a0f1-45ab-b9f6-d55d957cdbed/local.rds?AWSAccessKeyId=ASIATLYQ5N5XWS5Y76IH&Signature=YoyrosoQHiIJjBtBgXv6Ohw3BEE%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEBoaCXVzLXdlc3QtMiJIMEYCIQDXFGIGVvBw35PxN2LhSWQq0ArLhSDYDptZQZy1fz3zuAIhAL2KWM9g7q96Uk0EktKDmGtKjWNi53HrZ5knL2Du294OKvQDCKP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQARoMMjMxNDI2ODQ2NTc1IgwXcCtVvGizH6FK34sqyAP0ffNF8YgVPrjraRxGTOU3whOvq%2FP%2BUMpjMGOZOnoSfmVHLmqw3%2FokEP5%2BVBkSom6QhYhsuDa74ga%2Frhn2f9%2FX8%2F8pdODqvLPRw%2FIXSmky0a1fdxPjMBQiU3weiUELyz29Z0683mS%2FDQU5AEaHTSJIs4ZICSZsdcVy5JrixodfCk7cKBDxWKgeREXKnCd25khAxN8ZsOs4avfOgDdA3peUHoeYuF8BZC%2FIA73LRE21pcXUsqkz26ZaiGCmW2jQHAGjDC79uL9pbdBtqOhSnwfD8ff3KtOOh8etSQrnLPB9x3k1MxpAWj30sHjjJjZnLobd5o22B2VToPgU7z%2FvCGsfUoPCddBcmGxe1JPgCdKcYLIKAEuNlPaXlpTWfTv%2BAybmwHY6GNl7mmY77Hkn3LKOcJDQyc3ZT479sCb1IjcNTLtPvWDsF7fcxJPZF7Rz3leKmDHR%2BzCuo0mKmDWVYwKkFdlnKorZRqR7TP0tF5dvxXOVoI3BHLRe1ItSLdNUKrB52FaJl6stM%2BbvUoxRRoYQhGGt6Wl2qiSnnnir3irDmQV6gfJx6dvWNcypSQMjupGujRD4SNDgReHQWodbmxB4z0IwhRYDyNMw%2B6SYnwY6pAEj3vumI9ACqgIWhaQrh6OPM8OXdHbMqxF3YQphCL9kUQ1LEu6GKB1LI7lGgigwwGnBUD7oEERfcSqU5QZDDK4jcxZYHUW9N7fovRneoZgbRPthnPRzkjkH8mXNOKO9KgAvTnE%2FIpq%2BurlOC%2B7%2BjLiJEG3QRDY%2F5lwdL03fphECbc1zGCGPi2Kf3HLRJ2IA8dZCsRbuU6yx%2BhsI%2B8TSjylB4fKaSg%3D%3D&Expires=1676636619" &

TAG = "bioRxiv_Novella_Rausell"

setwd("/zp1/data/plyu3/Altas_add_CellAnn/Mouse_kidney_atlas")

seurat_obj <- readRDS("local.rds")

table(seurat_obj$development_stage)

seurat_obj <- Convert_Mat_to_Symbol(seurat_obj,sp="M")

seurat_obj_list = Seurat::SplitObject(seurat_obj,"development_stage")
###########

for(i in 1:length(seurat_obj_list)){
	tmp = names(seurat_obj_list)[i]
	print(tmp)
	tmp = gsub(" ","_",tmp)
	print(tmp)
	####
	new_folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/Mouse_kidney_atlas/",tmp)
	print(new_folder)
	####
	command = paste("mkdir",new_folder)
	system(command)
	####
	####
	new_file = paste0(new_folder,"/",tmp,"_seurat_obj")
	####
	print(new_file)
	####
	seurat_obj_list[[i]]$celltype = seurat_obj_list[[i]]$cell_type
	saveRDS(seurat_obj_list[[i]],file=new_file)
}

############
############
############


setwd("/zp1/data/plyu3/Altas_add_CellAnn/Mouse_kidney_atlas")
files = list.files()
files = files[c(1,2,3,4,6,8)]

for(i in 1:length(files)){
	tmp = files[i]
	print(tmp)
	##
	to = "/zp1/data/plyu3/CellAnn_batch21/"
	##
	folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/Mouse_kidney_atlas/",tmp)
	print(folder)
	Read_Seurat_file_in_the_folder_UCSC(folder)
	Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
	TAG = paste0("Mouse_kidney","_",tmp)
	print(TAG)
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)
}


"ENSMUSG00000037820"


###########
###########
########### OK!!! let us find the study in singleR #########
###########
########### we will check the mouse altas !!! ##############
###########
Mapping the Mouse Cell Atlas by Microwell-Seq
###########
PMID: 29474909

###########
https://figshare.com/articles/dataset/HCL_DGE_Data/7235471
cd /zp1/data/plyu3/Altas_add_CellAnn/
mkdir MCA1.1
cd MCA1.1

TAG = "29474909_MCA1_1"





##########
##########
##########
##########
##########

head(colnames(seuratObject_Mat))
head()


Convert("MCA1.1_adata.gzip.h5ad", "MCA1.1_adata.gzip.h5seurat")
#### This creates a copy of this .h5ad object reformatted into .h5seurat inside the example_dir directory

#### This .d5seurat object can then be read in manually

####
#### 
conda activate seurat4
python
import anndata
adata = anndata.read("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/MCA1.1_adata.h5ad")
adata.write("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/MCA1.1_adata.gzip.h5ad", compression="gzip")

####
####
####
#### Next we will read the annotation files ####

setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/annotation_rmbatch_data_revised417")

files = list.files()

table_list <- list()


for(i in 1:length(files)){
	tmp_table <- read.table(files[i],sep=',',header=T)
	print(dim(tmp_table))
	table_list = c(table_list,list(tmp_table[,1:14]))
}

table_list_merge = do.call("rbind",table_list)

setwd('/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/')

save(table_list_merge,file='table_list_merge')

####
####

k = which(colnames(MCA1.1_seurat) %in% table_list_merge$Cell_id == T)

####
#### Not match !!! ####
####
ssh plyu3@omb2.onc.jhmi.edu
U[9C20&&


conda activate seurat4

R

setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/new")

####
matrix_list <- list()

files = list.files()

for(i in 1:length(files)){
	print(i)
	tmp_table <- read.table(files[i],sep=" ",header=T)
	print(dim(tmp_table))
	matrix_list <- c(matrix_list,list(tmp_table))
}

load("matrix_list")
####
#### red #####
#### red #####
#### we start from here !!! ####
#### 上传所有的 table 和 list ####
####
#### add names ？####
####
#### can not "cbind" ##########
####

matrix_list[[1]][1:10,1:10]

Seurat_list <- list()
tag_list <- c()
for(i in 1:length(matrix_list)){
	library(Seurat)
	print(i)
	tmp_seurat = CreateSeuratObject(matrix_list[[i]])
	print(dim(tmp_seurat))
	tag = colnames(tmp_seurat)[1]
	tag = strsplit(tag,split=".",fixed=T)[[1]][1]
	print(tag)
	tag_list <- c(tag_list,tag)
	Seurat_list <- c(Seurat_list,list(tmp_seurat))
}

####
####

names(Seurat_list) <- tag_list


####
#### Then we add annotations to the Seurat_list ####
####
setwd('/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/')

load("table_list_merge")

new_Seurat_list <- list()

for(i in 1:length(Seurat_list)){
	tmp = Seurat_list[[i]]
	k = which(colnames(tmp) %in% table_list_merge$Cell_id == T)
	print(names(Seurat_list)[i])
	ratio = round(length(k) / dim(tmp)[2],2)
	print(ratio)
	######
	if(ratio > 0){
		tmp_cl = tmp[,k]
		m = match(colnames(tmp_cl),table_list_merge$Cell_id)
		tmp_table_list_merge = table_list_merge[m,]
		tmp_cl@meta.data = cbind(tmp_cl@meta.data,tmp_table_list_merge)
		tmp_cl <- list(tmp_cl)
		names(tmp_cl) <- names(Seurat_list)[i]
		new_Seurat_list <- c(new_Seurat_list,tmp_cl)
	}
}

save(new_Seurat_list,file="new_Seurat_list")
##### 
tag1 = c()
tag2 = c()
tag3 = c()

for(i in 1:length(new_Seurat_list)){
	tmp = new_Seurat_list[[i]]
	tmp_tag1 = names(new_Seurat_list)[i]
	tmp_tag2 = new_Seurat_list[[i]]@meta.data$Sample[1]
	tmp_tag3 = new_Seurat_list[[i]]@meta.data$Biomaterial[1]
	####
	tag1 <- c(tag1,tmp_tag1)
	tag2 <- c(tag2,tmp_tag2)
	tag3 <- c(tag3,tmp_tag3)
	####
}

dat = data.frame(tag1,tag2,tag3)

#### OK! ####
#### we need to write this table !!! #######

write.table(dat,file="dat.txt",sep="\t",quote=F,row.names=F)

#### This is the Human datasets !!!! #####
#### red red red red red red red #########
#### pink pink pink pink pink pink #######

#### 
conda activate seurat4
R
library(Seurat)
setwd('/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/')

load("new_Seurat_list")


#### we see the gene list !!! ####
####

head(rownames(new_Seurat_list[[1]])

#### It's the HCL genes #########
#### then we add the information to the dat.txt #####
#### OK!!! let us do it !!! #####
#### add dataset tag to the dat.txt #####

HCL_dat <- read.table("HCL_dat.txt",head=T)

####
#### merge and rename the seurat files !!! #######
####

system("mkdir /zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/HCL")

levels = levels(as.factor(HCL_dat$index))

for(i in 1:length(levels)){
	new_folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/HCL/",levels[i])
	command = c(paste("mkdir",new_folder))
	system(command)
}

####
#### Next we will merge the seurat and save them to the folder !! ###
####

new_folder2 = c("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/HCL/")

for(i in 1:length(levels)){
	temp_lev = levels[i]
	print(temp_lev)
	######
	temp_samples = HCL_dat$tag1[which(HCL_dat$index == temp_lev)]
	######
	seurat_obj_list = new_Seurat_list[which(names(new_Seurat_list) %in% temp_samples == T)]
	######
	if(length(seurat_obj_list) == 1){
		seurat_obj_list = seurat_obj_list[[1]]
	}
	if(length(seurat_obj_list) > 1){
		seurat_obj_list = merge(seurat_obj_list[[1]],seurat_obj_list[2:length(seurat_obj_list)])
	}
	#######
	seurat_obj_list_rds = seurat_obj_list
	seurat_obj_list_rds$celltype = seurat_obj_list_rds$Celltype
	#######
	save_file = new_folder2
	save_file = paste0(save_file,temp_lev,"/",temp_lev,"_seurat_obj")
	saveRDS(seurat_obj_list_rds,file=save_file)
}


#### then for each folder: we process the files !!! ######
####

####

setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/HCL")
files = list.files()

i = c(18,25,38)

for(i in 39:length(files)){
	print(paste("NO",i))
	tmp_folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/HCL/",files[i])
	Read_Seurat_file_in_the_folder_UCSC(tmp_folder)
	Prepare_Seurat_file_in_the_folder_UCSC(tmp_folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(tmp_folder)
	tmp_tag = files[i]
	to = "/zp1/data/plyu3/CellAnn_batch20/"
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(tmp_folder,to,tmp_tag)
}

i = 38

tmp_folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/HCL/",files[i])
setwd(tmp_folder)
list.files()
seurat_obj = readRDS("32214235_Human_cell_landscape_muscle_organ_seurat_obj")
table(seurat_obj$celltype)
k = which(seurat_obj$celltype == "Striated muscle\xa0cell")
seurat_obj$celltype[k] = "Striated muscle cell"
saveRDS(seurat_obj,file="32214235_Human_cell_landscape_muscle_organ_seurat_obj")

Read_Seurat_file_in_the_folder_UCSC(tmp_folder)
Prepare_Seurat_file_in_the_folder_UCSC(tmp_folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(tmp_folder)
tmp_tag = "32214235_Human_cell_landscape_muscle_organ"
to = "/zp1/data/plyu3/CellAnn_batch20/"
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(tmp_folder,to,tmp_tag)


#####
#####
#####
##### OK!!! Next we will process MCL !!! ######
#####
##### This is the MCL script !!!! ######
#####
#####

conda activate seurat4
R

library(SeuratDisk)
setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1")

seuratObject <- LoadH5Seurat("MCA1.1_adata.gzip.h5seurat")

seuratObject_Mat = seuratObject[['RNA']]@counts

##### This is the MCL script !!!! ######
#####

library(Seurat)
MCA1.1_seurat <- CreateSeuratObject(seuratObject_Mat)

####
#### Next we will split the Seurat !!! ##########
####

MCA1.1_seurat$cell_id = colnames(MCA1.1_seurat)

#### OK!!! #####
####
setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1")
data <- readxl::read_excel("MCA1.1_cell_info.xlsx")

m = match(MCA1.1_seurat$cell_id,data$cellnames)

MCA1.1_seurat$tissue = data$tissue[m]
MCA1.1_seurat$stage = data$stage[m]
MCA1.1_seurat$celltype = data$celltype[m]
MCA1.1_seurat$cluster = data$cluster[m]

MCA1.1_seurat$class = paste(MCA1.1_seurat$stage,MCA1.1_seurat$tissue,sep="_")

#### OK!!! write the tables !!! ####
####
dat = MCA1.1_seurat@meta.data[,c(5:9)]
dat = dat[!duplicated(dat$class),]
#### OK! ####
#### we need to write this table !!! #######

write.table(dat,file="MCA11.dat.txt",sep="\t",quote=F,row.names=F)

#### align dat to the datsheet1 !!! ########


MCL_dat <- read.table("MCA11.dat.txt",head=T,sep="\t")

####
#### merge and rename the seurat files !!! #######
####

#### system("mkdir /zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/MCL11")

levels = levels(as.factor(MCL_dat$tag))

for(i in 1:length(levels)){
	new_folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/MCL11/",levels[i])
	command = c(paste("mkdir",new_folder))
	system(command)
}

#### 
####
####

MCA1.1_seurat_sp = SplitObject(MCA1.1_seurat,"class")

####


new_folder2 = c("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/MCL11/")

for(i in 1:length(levels)){
	temp_lev = levels[i]
	print(temp_lev)
	######
	temp_samples = MCL_dat$class[which(MCL_dat$tag == temp_lev)]
	######
	seurat_obj_list = MCA1.1_seurat_sp[which(names(MCA1.1_seurat_sp) %in% temp_samples == T)]
	######
	if(length(seurat_obj_list) == 1){
		seurat_obj_list = seurat_obj_list[[1]]
	}
	if(length(seurat_obj_list) > 1){
		seurat_obj_list = merge(seurat_obj_list[[1]],seurat_obj_list[2:length(seurat_obj_list)])
	}
	#######
	seurat_obj_list_rds = seurat_obj_list
	seurat_obj_list_rds$celltype = seurat_obj_list_rds$celltype
	#######
	save_file = new_folder2
	save_file = paste0(save_file,temp_lev,"/",temp_lev,"_seurat_obj")
	saveRDS(seurat_obj_list_rds,file=save_file)
}



setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/MCL11")
files = list.files()

i = c(12,22)


for(i in 23:length(files)){
	print(paste("NO",i))
	tmp_folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/MCL11/",files[i])
	Read_Seurat_file_in_the_folder_UCSC(tmp_folder)
	Prepare_Seurat_file_in_the_folder_UCSC(tmp_folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(tmp_folder)
	tmp_tag = files[i]
	to = "/zp1/data/plyu3/CellAnn_batch20/"
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(tmp_folder,to,tmp_tag)
}

i = 22
tmp_folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/MCA1.1/MCL11/",files[i])
setwd(tmp_folder)
list.files()
seurat_obj = readRDS("29474909_MCA1_1_Embryonic_Stem_Cells_seurat_obj")

#### tag = "29474909_MCA1_1_adult_Prostate" ####

########
####### Next is the MCA2.0 !!! ########
########

########
########
setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA2.0")

data <- read.csv("MCA2.0_cell_info.csv")

table(data$Stage)
table(data$Tissue_detail)
table(data$Tissue_annotation)
######## OK!!! Tissue_detail !!! #####
########

####
#### 
conda activate seurat4
python
import anndata
adata = anndata.read("/zp1/data/plyu3/Altas_add_CellAnn/MCA2.0/MCA2.0_Fig1_adata.h5ad")
adata.write("/zp1/data/plyu3/Altas_add_CellAnn/MCA2.0/MCA2.0_Fig1_adata.gzip.h5ad", compression="gzip")

adata_X = adata.X

var = adata.var

var.to_csv('features.csv',index=False)



conda activate seurat4
R
library(SeuratDisk)
setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA2.0")
Convert("MCA2.0_Fig1_adata.gzip.h5ad", "MCA2.0_adata.gzip.h5seurat")

seuratObject <- LoadH5Seurat("MCA2.0_adata.gzip.h5seurat")
seuratObject_Mat = seuratObject[['RNA']]@counts

features = read.table("features.csv",sep=",",header=T)

rownames(seuratObject_Mat) <- features$features

library(Seurat)
MCA2.0_seurat <- CreateSeuratObject(seuratObject_Mat)

m = match(colnames(MCA2.0_seurat),data$X)

MCA2.0_seurat$Tissue_detail = data$Tissue_detail[m]
MCA2.0_seurat$Main_annotation = data$Main_annotation[m]

#######
dat = MCA2.0_seurat@meta.data[,c(1,4,5)]
dat = dat[!duplicated(dat$Tissue_detail),]
#### OK! ####
#### we need to write this table !!! #######

write.table(dat,file="MCA20.dat.txt",sep="\t",quote=F,row.names=F)


data <- read.csv("MCA20.dat.txt",sep="\t",header=T)

MCA2.0_seurat_sp = SplitObject(MCA2.0_seurat,"Tissue_detail")

names(MCA2.0_seurat_sp)

###

levels = levels(as.factor(data$tag))

for(i in 1:length(levels)){
	new_folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/MCA2.0/",levels[i])
	command = c(paste("mkdir",new_folder))
	system(command)
}




new_folder2 = c("/zp1/data/plyu3/Altas_add_CellAnn/MCA2.0/")

for(i in 1:length(levels)){
	temp_lev = levels[i]
	print(temp_lev)
	######
	temp_samples = data$Tissue_detail[which(data$tag == temp_lev)]
	######
	seurat_obj_list = MCA2.0_seurat_sp[which(names(MCA2.0_seurat_sp) %in% temp_samples == T)]
	######
	if(length(seurat_obj_list) == 1){
		seurat_obj_list = seurat_obj_list[[1]]
	}
	if(length(seurat_obj_list) > 1){
		seurat_obj_list = merge(seurat_obj_list[[1]],seurat_obj_list[2:length(seurat_obj_list)])
	}
	#######
	seurat_obj_list_rds = seurat_obj_list
	seurat_obj_list_rds$celltype = seurat_obj_list_rds$Main_annotation
	#######
	save_file = new_folder2
	save_file = paste0(save_file,temp_lev,"/",temp_lev,"_seurat_obj")
	saveRDS(seurat_obj_list_rds,file=save_file)
}



mkdir /zp1/data/plyu3/CellAnn_batch24/

#### pink ####
#### pink ####
#### pink ####
#### pink ####

setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA2.0")
files = list.files()
files = files[1:52]

for(i in 1:length(files)){
	print(paste("NO",i))
	tmp_folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/MCA2.0/",files[i])
	Read_Seurat_file_in_the_folder_UCSC(tmp_folder)
	Prepare_Seurat_file_in_the_folder_UCSC(tmp_folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(tmp_folder)
	tmp_tag = files[i]
	to = "/zp1/data/plyu3/CellAnn_batch24/"
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(tmp_folder,to,tmp_tag)
}





##########
########## OK!!! Next is MCA3.0 ###############
##########

setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA30")
setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA30/MCA3.0_Tissue_DGE")
files = list.files()

for(i in 1:length(files)){
	tmp_files = files[i]
	command = paste("unzip",tmp_files)
	print(command)
	system(command,wait=F)
}

##########
setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA30/MCA3.0_Tissue_DGE")
files = list.files()
files_DEGs = files[grep("_dge.csv",files)]
files_Gene = files[grep("_gene.csv",files)]

seurat_list = list()

for(i in 1:length(files_DEGs)){
	print(i)
	tmp_DEGs = files_DEGs[i]
	print(tmp_DEGs)
	####
	#tmp_DEGs = read.csv(tmp_DEGs)
	####
	temp_gene = gsub("_dge","_gene",tmp_DEGs) 
	print(temp_gene)
	temp_deg_table = read.csv(tmp_DEGs)
	####
	temp_gene_table = read.csv(temp_gene,header=F)
	####
	temp_gene_mat = as.matrix(temp_deg_table)
	####
	rownames(temp_gene_mat) = temp_gene_table$V1
	####
	library(Seurat)
	temp_seurat = CreateSeuratObject(temp_gene_mat)
	####
	seurat_list <- c(seurat_list,list(temp_seurat))
}

#############
############ Next we will add the annotations ########
#############

save(seurat_list,file="seurat_list")

setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA30")

data <- readxl::read_excel("MCA3.0_data_annotation.xlsx")
data <- data.frame(data)


names = c()
for(i in 1:length(seurat_list)){
	tmp_seurat = seurat_list[[i]]
	#####
	m = match(colnames(tmp_seurat),data$cell_name)
	print(summary(m))
	#####
	tmp_seurat$stage_tissue = data$stage_tissue[m]
	tmp_seurat$celltype = data$cell_type[m]
	#####
	seurat_list[[i]] = tmp_seurat
	#####
	names = c(names,tmp_seurat$stage_tissue[1])
}

names[3] = "BoneMarrow"

names(seurat_list) <- names

table = data.frame(samples = names)

write.table(table,file="MCA30.txt",sep="\t",quote=F,row.names=F)

#########
setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA30")
data <- read.table(file="MCA30.txt",sep="\t",header=T)


#########

levels = levels(as.factor(data$tag))

for(i in 1:length(levels)){
	new_folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/MCA30/",levels[i])
	command = c(paste("mkdir",new_folder))
	print(command)
	system(command,wait=F)
}

#########

for(i in 1:length(data$tag)){
	tmp_tag = data$tag[i]
	tmp_j = which(names(seurat_list) == data$samples[i])
	tmp_seurat_list = seurat_list[[tmp_j]]
	#####
	#####
	target_file = paste0("/zp1/data/plyu3/Altas_add_CellAnn/MCA30/",tmp_tag,"/",tmp_tag,"_seurat_obj")
	print(target_file)
	#####
	saveRDS(tmp_seurat_list,file=target_file)
}



setwd("/zp1/data/plyu3/Altas_add_CellAnn/MCA30")
files = list.files()
files = files[1:41]

######
######

for(i in 1:length(files)){
	print(paste("NO",i))
	tmp_folder = paste0("/zp1/data/plyu3/Altas_add_CellAnn/MCA30/",files[i])
	Read_Seurat_file_in_the_folder_UCSC(tmp_folder)
	Prepare_Seurat_file_in_the_folder_UCSC(tmp_folder,norm="counts")
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2(tmp_folder)
	tmp_tag = files[i]
	to = "/zp1/data/plyu3/CellAnn_batch21/"
	Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(tmp_folder,to,tmp_tag)
}

############ OK!!!! ##############
############ ############### #####
############ getwd ###############
############ ############### #####
############ Next we will add sentence on the paper !!!! ###
############ ############### #####
############ ############### #####


















Systematic identification of cell-fate regulatory programs using a single-cell atlas of mouse development

########### mouse dev cell datasets ########################
PMID: 35817981
https://figshare.com/s/340e8e7f349559f61ef6
cd /zp1/data/plyu3/Altas_add_CellAnn/
mkdir MCA2.0
cd MCA2.0

TAG = "35817981_MCA2_0"



Construction of a cross-species cell landscape at single-cell level 
############
PMID: 35929025
https://figshare.com/s/1ab3c6d7648d12247eb2
cd /zp1/data/plyu3/Altas_add_CellAnn/
mkdir MCA3.0
cd MCA3.0

TAG = "35929025_MCA3_0"

############
############
############
############ ssn #######



############
split the objects !!!!!!
Cross-tissue immune cell analysis reveals tissue-specific features in humans

############


########### see How many different organs #########
###########

table_all = read.table("/Users/pin/Desktop/CellAlignment_Server_version2/database/database_sheet.csv",sep=",",header=T)

table_all$small = sapply(strsplit(table_all$sample,split=" (",fixed=T),function(x) x[[1]])

########### then we count the papers !!!! #######
###########

Count_papers <- function(table_all){
	levels = names(table(table_all$small))
	#####
	dat = data.frame(organ=levels,Hpapers=0,Mpapers=0)
	#####
	for(i in 1:length(levels)){
		k1 = which(table_all$small == levels[i])
		subtable = table_all[k1,]
		######
		k2 = which(subtable$species == 'Mouse')
		subtable1 = subtable[k2,]
		length_1 = subtable1$study
		length_1 = length_1[!duplicated(length_1)]
		dat$Mpapers[i] = length(length_1)
		#######
		k3 = which(subtable$species == 'Human')
		subtable2 = subtable[k3,]
		length_2 = subtable2$study
		length_2 = length_2[!duplicated(length_2)]
		dat$Hpapers[i] = length(length_2)
	}
}


###########
#################### OK!!! we will plot the figure2 !!! ##############
###########

setwd("/zp1/data/plyu3/Altas_add_CellAnn")

Figure2_plot = read.table("/zp1/data/plyu3/Altas_add_CellAnn/CellAnn_Figure2_tissues2.txt",sep="\t",header=T)

colnames(Figure2_plot)

H_plot <- Figure2_plot[,c(1,3,5,7,9,11)]

order = H_plot$Organ.Labels[order(H_plot$Human.CellAnn,decreasing=T)]

library(reshape2)

k = which(rowSums(H_plot[,-1]) == 0)

H_plot = H_plot[-k,]

H_plot_melt = melt(H_plot)

H_plot_melt$variable = gsub("Human.","",H_plot_melt$variable)

#######
H_plot_melt$Organ.Labels = factor(H_plot_melt$Organ.Labels,levels=order)
#######


library(ggplot2)

ggplot(H_plot_melt,aes(x=Organ.Labels,y=value,fill=variable)) + geom_bar(stat="identity", color="white", position=position_dodge(0.3))+
  theme_classic() + theme(axis.text.x = element_text(angle=45, vjust=1, hjust=1)) + xlab("Organs") + ylab("Number of papers included")

ggsave("temp.png",height=4,width=15)


#####
##### red red red red red red red ########
#####


Figure2_plot = read.table("/zp1/data/plyu3/Altas_add_CellAnn/CellAnn_Figure2_tissues2.tsv",sep="\t",header=T)

colnames(Figure2_plot)

H_plot <- Figure2_plot[,c(1,2,4,6,8,10)]

H_plot[19,2] = 5

library(reshape2)

k = which(rowSums(H_plot[,-1]) == 0)

order = H_plot$Organ.Labels[order(H_plot$Mouse.CellAnn,decreasing=T)]


H_plot = H_plot[-k,]

H_plot_melt = melt(H_plot)

H_plot_melt$variable = gsub("Mouse.","",H_plot_melt$variable)

#######
H_plot_melt$Organ.Labels = factor(H_plot_melt$Organ.Labels,levels=order)
#######

col_list = c("#EF9000","#F6BA00","#9EA220","#86BF38","#EC6F64","#D11536","#936DAD","#A74997","#61BFB9","#0097BB","#026AB1")

library(ggplot2)


ggplot(H_plot_melt,aes(x=Organ.Labels,y=value,fill=variable)) + geom_bar(stat="identity", color="white", position=position_dodge(0.8))+
  theme_classic() + theme(axis.text.x = element_text(angle=45, vjust=1, hjust=1)) + xlab("Organs") + ylab("Number of papers included") + scale_fill_manual(values=c("#EC6F64","#61BFB9","#0097BB","#026AB1","#9EA220")) + scale_y_continuous(breaks=c(4,8,12,16,20,24))

ggsave("temp.png",height=4,width=15)


######
###### Next we will add the testis mouse datasets #####
######

cd /zp1/data/plyu3/cellann_add_paper

mkdir PMID_30061742_Mouse_testis
mkdir /zp1/data/plyu3/CellAnn_batch10/

######
library(Seurat)
Sperm_obj$celltype = Sperm_obj$cell_type

saveRDS(Sperm_obj,file="Mouse_testis_seurat_obj")
######

######
Single-cell RNA-seq uncovers dynamic processes and critical regulators in mouse spermatogenesis

folder = "/zp1/data/plyu3/cellann_add_paper/PMID_30061742_Mouse_testis"

to = "/zp1/data/plyu3/CellAnn_batch10/"

TAG = "30061742_Mouse_testis"

Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)



##### 
A Comprehensive Roadmap of Murine Spermatogenesis Defined by Single-Cell RNA-Seq

PMID: 30146481

cd /zp1/data/plyu3/cellann_add_paper

mkdir PMID_30146481_Mouse_testis


###### 
setwd("/zp1/data/plyu3/cellann_add_paper/PMID_30146481_Mouse_testis")
library(readr)
matrix = read_delim("GSE112393_MergedAdultMouseST25_DGE.txt",delim="\t")

matrix[1:5,1:5]

######
cluster <- read.table('GSE112393_MergedAdultMouseST25_PerCellAttributes.txt',sep="\t")

table(cluster$V2)

Cell type: 1-InnateLymph; 2-Macrophage; 3-Endothelial; 4-Myoid; 5-Leydig; 6-Sertoli; 7-Unknown; 8-SPG; 9-Scytes; 10-STids; 11-Elongating

cluster = cluster[,c(1,3)]

colnames(cluster) <- c('cell','index')

celltype_list = c("InnateLymph","Macrophage","Endothelial","Myoid","Leydig","Sertoli","Unknown","SPG","Scytes","STids","Elongating")

cluster$celltype = celltype_list[cluster$index]


matrix1 = data.frame(matrix)

rownames = matrix1[,1]

matrix1 = as.matrix(matrix1[,-1])

rownames(matrix1) <- rownames
########
######## OK!!! ############
########

Broad_create_seurat_obj(matrix1,cluster[,c(1:3)],file="30146481_Mouse_testis_seurat_obj")

########
########
folder = "/zp1/data/plyu3/cellann_add_paper/PMID_30146481_Mouse_testis"
to = "/zp1/data/plyu3/CellAnn_batch10/"
TAG = "30146481_Mouse_testis"


Read_Seurat_file_in_the_folder_UCSC(folder)
Prepare_Seurat_file_in_the_folder_UCSC(folder,norm="counts")
Prepare_Seurat_file_in_the_folder_UCSC_STEP2(folder)
Prepare_Seurat_file_in_the_folder_UCSC_STEP2_copy_folder(folder,to,TAG)


###
### move and check !!!! #######
###

in the CellAnn_batch10

### 可以 ！！！ #################


